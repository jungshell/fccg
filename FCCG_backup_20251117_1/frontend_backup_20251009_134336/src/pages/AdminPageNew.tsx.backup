import React, { useState, useEffect, useCallback, useMemo } from 'react';
import {
  Box,
  Button,
  Card,
  CardBody,
  Flex,
  SimpleGrid,
  Text,
  VStack,
  useToast,
  Spinner,
  Stat,
  StatLabel,
  StatNumber,
  StatHelpText,
  StatArrow,
  FormControl,
  FormLabel,
  Input,
  Textarea,
  HStack,
  Icon,
  Divider,
  Switch,
  Select,
  NumberInput,
  NumberInputField,
  NumberInputStepper,
  NumberIncrementStepper,
  NumberDecrementStepper,
  Badge,
  Modal,
  ModalOverlay,
  ModalContent,
  ModalHeader,
  ModalBody,
  ModalCloseButton,
  Table,
  Thead,
  Tbody,
  Tr,
  Th,
  Td,
  TableContainer,
  ButtonGroup,
  Progress
} from '@chakra-ui/react';
import { ViewIcon, CalendarIcon, SettingsIcon, InfoIcon, AddIcon, EditIcon, DeleteIcon } from '@chakra-ui/icons';
import { getAllMembers, getGames, getMemberStats, type Game } from '../api/auth';
import MemberManagement from '../components/MemberManagement';
import GameManagement from '../components/GameManagement';
import ThisWeekScheduleManagement from '../components/ThisWeekScheduleManagement';
import { useAuthStore } from '../store/auth';

// ===== íƒ€ì… ì •ì˜ =====
interface ThisWeekSchedule {
  id: number;
  date: string;
  event: string;
  description?: string;
  createdById: number;
  createdAt: string;
  updatedAt: string;
  createdBy?: {
    id: number;
    name: string;
  };
}

interface ExtendedMember {
  id: number;
  name: string;
  email: string;
  role: 'SUPER_ADMIN' | 'ADMIN' | 'MEMBER';
  status: 'ACTIVE' | 'INACTIVE' | 'SUSPENDED' | 'DELETED';
  createdAt?: string;
}

interface Player {
  id: string;
  name: string;
  position: string;
  jerseyNumber?: number;
  phone?: string;
  email?: string;
  joinDate: string;
  preferredPosition: string[];
  skillRating: number;
  attendanceRate: number;
  isActive: boolean;
  notes?: string;
}

// ì•Œë¦¼ íƒ€ì… ì •ì˜
interface Notification {
  id: string;
  type: 'GAME_REMINDER' | 'VOTE_REMINDER' | 'NEW_MEMBER' | 'GAME_RESULT' | 'VOTE_WARNING' | 'MEMBER_SUSPENDED';
  title: string;
  message: string;
  recipients: number[]; // ì‚¬ìš©ì ID ë°°ì—´
  sentAt: string;
  status: 'PENDING' | 'SENT' | 'FAILED';
  deliveryMethods: ('email' | 'push' | 'inapp')[];
  metadata?: any;
}

// ì•Œë¦¼ ë°œì†¡ ê²°ê³¼ íƒ€ì…
interface NotificationDeliveryResult {
  notificationId: string;
  userId: number;
  method: 'email' | 'push' | 'inapp';
  status: 'success' | 'failed';
  errorMessage?: string;
  sentAt: string;
}

// ìµœê·¼ í™œë™ íƒ€ì… ì •ì˜
interface ActivityLog {
  id: string;
  userId: number;
  userName: string;
  action: 'LOGIN' | 'LOGOUT' | 'GAME_JOIN' | 'GAME_CANCEL' | 'VOTE_PARTICIPATE' | 'VOTE_ABSENT' | 'ANNOUNCEMENT_CREATE' | 'ANNOUNCEMENT_EDIT' | 'MEMBER_STATUS_CHANGE' | 'VOTE_WARNING' | 'MEMBER_SUSPENDED';
  description: string;
  timestamp: string;
  metadata?: any;
}

// íˆ¬í‘œ ì°¸ì—¬ ê¸°ë¡ íƒ€ì…
interface VoteRecord {
  userId: number;
  userName: string;
  voteDate: string;
  participated: boolean;
  year: number;
}

interface Announcement {
  id: string;
  title: string;
  content: string;
  type: 'urgent' | 'normal' | 'info';
  startDate: string;
  endDate: string;
  isActive: boolean;
  author: string;
  createdAt: string;
  updatedAt: string;
  pinned: boolean;
}

interface NotificationSettings {
  gameReminder: {
    enabled: boolean;
    beforeHours: number;
    targets: string[];
  };
  voteReminder: {
    enabled: boolean;
    beforeHours: number;
    targets: string[];
  };
  newMemberNotification: {
    enabled: boolean;
    targets: string[];
  };
  gameResultNotification: {
    enabled: boolean;
    targets: string[];
  };
}

interface SiteSettings {
  teamName: string;
  teamDescription: string;
  contactEmail: string;
  contactPhone: string;
  address: string;
  foundedYear: string;
  teamMotto: string;
}

type UserRole = 'SUPER_ADMIN' | 'ADMIN' | 'MEMBER';

// íšŒì› ë“±ê¸‰ë³„ ê¶Œí•œ ì •ì˜
const rolePermissions = {
  SUPER_ADMIN: {
    name: 'ìŠˆí¼ê´€ë¦¬ì',
    color: 'red',
    permissions: ['all']
  },
  ADMIN: {
    name: 'ê´€ë¦¬ì',
    color: 'blue',
    permissions: ['member_management', 'game_management', 'content_management', 'homepage_management']
  },
  MEMBER: {
    name: 'íšŒì›',
    color: 'gray',
    permissions: ['vote', 'schedule_view', 'photo_upload', 'comment_write']
  }
};

export default function AdminPageNew() {
  const [userList, setUserList] = useState<ExtendedMember[]>([]);
  const [games, setGames] = useState<Game[]>([]);
  const [thisWeekSchedules, setThisWeekSchedules] = useState<ThisWeekSchedule[]>([]);
  const [memberStats, setMemberStats] = useState<{
    totalMembers?: number;
    thisWeekGame?: number;
    nextWeekVote?: number;
  }>({});
  const [loading, setLoading] = useState(true);
  const [selectedMenu, setSelectedMenu] = useState('dashboard');
  const user = useAuthStore((s) => s.user);
  const [currentUserRole, setCurrentUserRole] = useState<UserRole>('MEMBER');
  

  
  // ì•Œë¦¼ ì„¤ì • ìƒíƒœ
  const [notificationSettings, setNotificationSettings] = useState<NotificationSettings>({
    gameReminder: {
      enabled: true,
      beforeHours: 24,
      targets: ['all']
    },
    voteReminder: {
      enabled: true,
      beforeHours: 12,
      targets: ['all']
    },
    newMemberNotification: {
      enabled: true,
      targets: ['admin']
    },
    gameResultNotification: {
      enabled: true,
      targets: ['all']
    }
  });
  const [isNotificationChanged, setIsNotificationChanged] = useState(false);

  // ì„ ìˆ˜ ê´€ë¦¬ ìƒíƒœ
  const [players, setPlayers] = useState<Player[]>([
    {
      id: '1',
      name: 'ì •ì„±ì¸',
      position: 'MF',
      jerseyNumber: 10,
      phone: '010-1234-5678',
      email: 'sti60val@gmail.com',
      joinDate: '2025-01-01',
      preferredPosition: ['MF', 'FW'],
      skillRating: 85,
      attendanceRate: 95,
      isActive: true,
      notes: 'íŒ€ ì£¼ì¥, ë¦¬ë”ì‹­ ì¢‹ìŒ'
    }
  ]);
  const [isPlayerFormOpen, setIsPlayerFormOpen] = useState(false);
  const [editingPlayer, setEditingPlayer] = useState<Player | null>(null);
  const [newPlayer, setNewPlayer] = useState<Partial<Player>>({
    name: '',
    position: 'MF',
    preferredPosition: [],
    skillRating: 70,
    attendanceRate: 0,
    isActive: true,
    joinDate: new Date().toISOString().split('T')[0]
  });

  // ê³µì§€ì‚¬í•­ ê´€ë¦¬ ìƒíƒœ
  const [announcements, setAnnouncements] = useState<Announcement[]>([
    {
      id: '1',
      title: 'ğŸ† 8ì›” ì •ê¸°ì „ ì•ˆë‚´',
      content: '8ì›” ì •ê¸°ì „ì´ 8ì›” 30ì¼(ì¼) ì˜¤í›„ 2ì‹œì— ì§„í–‰ë©ë‹ˆë‹¤. ë§ì€ ì°¸ì—¬ ë¶€íƒë“œë¦½ë‹ˆë‹¤.',
      type: 'urgent',
      startDate: '2025-08-20',
      endDate: '2025-08-30',
      isActive: true,
      author: 'ì •ì„±ì¸',
      createdAt: '2025-08-20T09:00:00Z',
      updatedAt: '2025-08-20T09:00:00Z',
      pinned: true
    }
  ]);
  const [isAnnouncementFormOpen, setIsAnnouncementFormOpen] = useState(false);
  const [editingAnnouncement, setEditingAnnouncement] = useState<Announcement | null>(null);
  const [newAnnouncement, setNewAnnouncement] = useState<Partial<Announcement>>({
    title: '',
    content: '',
    type: 'normal',
    startDate: new Date().toISOString().split('T')[0],
    endDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
    isActive: true,
    pinned: false
  });

  // ìµœê·¼ í™œë™ ë° íˆ¬í‘œ ê´€ë¦¬ ìƒíƒœ
  const [activityLogs, setActivityLogs] = useState<ActivityLog[]>([]);
  const [voteRecords, setVoteRecords] = useState<VoteRecord[]>([]);
  const [voteWarnings, setVoteWarnings] = useState<{userId: number, userName: string, warningCount: number, lastWarningDate: string}[]>([]);

  // ì•Œë¦¼ ì‹œìŠ¤í…œ ìƒíƒœ
  const [notifications, setNotifications] = useState<Notification[]>([]);
  const [notificationResults, setNotificationResults] = useState<NotificationDeliveryResult[]>([]);
  const [isNotificationSystemActive, setIsNotificationSystemActive] = useState(false);

  // ì‚¬ìš©ì ì •ë³´ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ê¶Œí•œ ì—…ë°ì´íŠ¸
  useEffect(() => {
    if (user?.email === 'sti60val@gmail.com') {
      setCurrentUserRole('SUPER_ADMIN');
    } else if (user?.role === 'ADMIN') {
      setCurrentUserRole('ADMIN');
    } else {
      setCurrentUserRole('MEMBER');
    }
  }, [user]);
  
  const toast = useToast();
  
  // ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì½”ë“œ ì œê±°
  // const { onOpen: onGameModalOpen } = useDisclosure();
  
  // íšŒì› í†µê³„ ìƒíƒœ
  // const [memberStats, setMemberStats] = useState({
  //   totalMembers: 0,
  //   activeMembers: 0,
  //   recentMembers: 0,
  //   activeRate: 0,
  //   averageAttendanceRate: 0
  // });
  
  // ë°ì´í„° ë¡œë“œ
  const loadData = useCallback(async () => {
    setLoading(true);
    
    try {
      console.log('ë°ì´í„° ë¡œë”© ì‹œì‘...');
      
      // ê° APIë¥¼ ê°œë³„ì ìœ¼ë¡œ í˜¸ì¶œí•˜ì—¬ ì¼ë¶€ê°€ ì‹¤íŒ¨í•´ë„ ë‹¤ë¥¸ ë°ì´í„°ëŠ” í‘œì‹œ
      
      // 1. íšŒì› ë°ì´í„° ë¡œë“œ (localStorage ìš°ì„ )
      try {
        let finalUserList: ExtendedMember[] = [];
        
        // localStorageì—ì„œ ì €ì¥ëœ íšŒì› ëª©ë¡ì„ ìµœìš°ì„ ìœ¼ë¡œ ì‚¬ìš©
        const savedUserList = localStorage.getItem('adminUserList');
        if (savedUserList) {
          try {
            const parsedUserList = JSON.parse(savedUserList);
            if (Array.isArray(parsedUserList) && parsedUserList.length > 0) {
              console.log('âœ… localStorageì—ì„œ íšŒì› ëª©ë¡ ìš°ì„  ì‚¬ìš©:', parsedUserList.length, 'ëª…');
              finalUserList = parsedUserList;
              setUserList(parsedUserList);
            }
          } catch (error) {
            console.error('localStorage íšŒì› ëª©ë¡ íŒŒì‹± ì‹¤íŒ¨:', error);
          }
        }

        // localStorageì— ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš°ì—ë§Œ APIì—ì„œ ê°€ì ¸ì˜¤ê¸°
        if (finalUserList.length === 0) {
          console.log('localStorageì— ë°ì´í„°ê°€ ì—†ì–´ì„œ APIì—ì„œ ë¡œë“œ ì‹œë„...');
          try {
            const membersResponse = await getAllMembers();
            console.log('íšŒì› ë°ì´í„° ì‘ë‹µ:', membersResponse);
            
            if (membersResponse && membersResponse.data) {
              console.log('ì›ë³¸ íšŒì› ë°ì´í„°:', membersResponse.data);
              
              // API ì‘ë‹µ êµ¬ì¡°ì— ë”°ë¼ ë°ì´í„° ì¶”ì¶œ
              let membersData = membersResponse.data;
              
              // ë§Œì•½ data.members í˜•íƒœë¼ë©´ ê·¸ ê°’ì„ ì‚¬ìš©
              if (membersResponse.data && typeof membersResponse.data === 'object' && 'members' in membersResponse.data) {
                membersData = (membersResponse.data as any).members;
              }
              
              if (Array.isArray(membersData) && membersData.length > 0) {
                const convertedMembers: ExtendedMember[] = membersData.map((member: any) => ({
                  id: member.id,
                  name: member.name,
                  email: member.email || '',
                  role: member.role || 'MEMBER',
                  status: member.status || 'ACTIVE',
                  createdAt: member.createdAt
                }));
                
                console.log('APIì—ì„œ ë³€í™˜ëœ íšŒì› ë°ì´í„°:', convertedMembers);
                setUserList(convertedMembers);
              } else {
                console.log('API íšŒì› ë°ì´í„°ê°€ ë¹„ì–´ìˆìŒ');
                setUserList([]);
              }
            } else {
              console.log('API ì‘ë‹µì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŒ');
              setUserList([]);
            }
          } catch (apiError) {
            console.error('API í˜¸ì¶œ ì‹¤íŒ¨:', apiError);
            setUserList([]);
          }
        } else {
          console.log('localStorage ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ API í˜¸ì¶œ ê±´ë„ˆëœ€');
        }
      } catch (error) {
        console.error('íšŒì› ë°ì´í„° ë¡œë“œ ì „ì²´ ì‹¤íŒ¨:', error);
        setUserList([]);
      }
      
      // 2. ê²½ê¸° ë°ì´í„° ë¡œë“œ (localStorage ìš°ì„ )
      try {
        let finalGamesList: any[] = [];
        
        // localStorageì—ì„œ ì €ì¥ëœ ê²½ê¸° ëª©ë¡ì„ ìš°ì„ ìœ¼ë¡œ ì‚¬ìš©
        const savedGamesList = localStorage.getItem('adminGamesList');
        if (savedGamesList) {
          try {
            const parsedGamesList = JSON.parse(savedGamesList);
            if (Array.isArray(parsedGamesList) && parsedGamesList.length > 0) {
              console.log('âœ… localStorageì—ì„œ ê²½ê¸° ëª©ë¡ ìš°ì„  ì‚¬ìš©:', parsedGamesList.length, 'ê²½ê¸°');
              finalGamesList = parsedGamesList;
              setGames(parsedGamesList);
            }
          } catch (error) {
            console.error('localStorage ê²½ê¸° ëª©ë¡ íŒŒì‹± ì‹¤íŒ¨:', error);
          }
        }

        // localStorageì— ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš°ì—ë§Œ APIì—ì„œ ê°€ì ¸ì˜¤ê¸°
        if (finalGamesList.length === 0) {
          console.log('localStorageì— ê²½ê¸° ë°ì´í„°ê°€ ì—†ì–´ì„œ APIì—ì„œ ë¡œë“œ ì‹œë„...');
          console.log('=== AdminPageNew - getGames() í˜¸ì¶œ ì‹œì‘ ===');
          const gamesResponse = await getGames();
          console.log('=== AdminPageNew - getGames() ì‘ë‹µ ===');
          console.log('ê²½ê¸° ë°ì´í„° ì‘ë‹µ:', gamesResponse);
          console.log('ì‘ë‹µ íƒ€ì…:', typeof gamesResponse);
          console.log('ì‘ë‹µ í‚¤ë“¤:', Object.keys(gamesResponse || {}));
          
          if (gamesResponse && gamesResponse.games) {
            console.log('AdminPageNew - ê²½ê¸° ë°ì´í„° ì„¤ì •:', gamesResponse.games);
            console.log('AdminPageNew - ê²½ê¸° ë°ì´í„° ê¸¸ì´:', gamesResponse.games.length);
            console.log('AdminPageNew - ê²½ê¸° ë°ì´í„° íƒ€ì…:', typeof gamesResponse.games);
            console.log('AdminPageNew - ê²½ê¸° ë°ì´í„°ê°€ ë°°ì—´ì¸ê°€:', Array.isArray(gamesResponse.games));
            setGames(gamesResponse.games);
            console.log('=== AdminPageNew - games ìƒíƒœ ì„¤ì • ì™„ë£Œ ===');
          } else {
            console.log('ê²½ê¸° ë°ì´í„° ì‘ë‹µì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŒ:', gamesResponse);
            console.log('gamesResponse.games ì¡´ì¬ ì—¬ë¶€:', !!gamesResponse?.games);
            setGames([]);
          }
        } else {
          console.log('localStorage ê²½ê¸° ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ API í˜¸ì¶œ ê±´ë„ˆëœ€');
        }
      } catch (error) {
        console.error('ê²½ê¸° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
        setGames([]);
      }
      
      // 3. í†µê³„ ë°ì´í„° ë¡œë“œ
      try {
        const statsResponse = await getMemberStats();
        console.log('í†µê³„ ë°ì´í„° ì‘ë‹µ:', statsResponse);
        
        if (statsResponse) {
          setMemberStats(statsResponse);
        } else {
          console.log('í†µê³„ ë°ì´í„° ì‘ë‹µì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŒ:', statsResponse);
          setMemberStats({});
        }
      } catch (error) {
        console.error('í†µê³„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
        setMemberStats({});
      }
      
    } catch (error) {
      console.error('ì „ì²´ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
      
      toast({
        title: 'ì¼ë¶€ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨',
        description: 'ì¼ë¶€ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.',
        status: 'warning',
        duration: 3000,
        isClosable: true,
      });
    } finally {
      setLoading(false);
    }
  }, []);

  // ìŠ¤ë§ˆíŠ¸ ìƒˆë¡œê³ ì¹¨ ì¡°ê±´ ì²´í¬ í•¨ìˆ˜
  const shouldRefresh = useCallback(() => {
    // 1. ëª¨ë‹¬ì´ ì—´ë ¤ìˆìœ¼ë©´ ìƒˆë¡œê³ ì¹¨ ì•ˆí•¨
    if (isPlayerFormOpen || isAnnouncementFormOpen) {
      console.log('ìƒˆë¡œê³ ì¹¨ ê±´ë„ˆëœ€ - ëª¨ë‹¬ ì—´ë¦¼');
      return false;
    }
    
    // 2. í¸ì§‘ ì¤‘ì´ë©´ ìƒˆë¡œê³ ì¹¨ ì•ˆí•¨
    if (editingPlayer || editingAnnouncement) {
      console.log('ìƒˆë¡œê³ ì¹¨ ê±´ë„ˆëœ€ - í¸ì§‘ ì¤‘');
      return false;
    }
    
    // 3. íšŒì›ê´€ë¦¬ ëª¨ë‹¬ì´ ì—´ë ¤ìˆëŠ”ì§€ í™•ì¸
    const memberManagementModals = document.querySelectorAll('[role="dialog"]');
    if (memberManagementModals.length > 0) {
      console.log('ìƒˆë¡œê³ ì¹¨ ê±´ë„ˆëœ€ - íšŒì›ê´€ë¦¬ ëª¨ë‹¬ ì—´ë¦¼');
      return false;
    }
    
    // 4. ì‚¬ìš©ìê°€ ì…ë ¥ ì¤‘ì´ë©´ ìƒˆë¡œê³ ì¹¨ ì•ˆí•¨
    const activeElement = document.activeElement;
    if (activeElement?.tagName === 'INPUT' || 
        activeElement?.tagName === 'TEXTAREA' ||
        activeElement?.tagName === 'SELECT') {
      console.log('ìƒˆë¡œê³ ì¹¨ ê±´ë„ˆëœ€ - ì‚¬ìš©ì ì…ë ¥ ì¤‘');
      return false;
    }
    
    // 5. ëª¨ë“  ì¡°ê±´ì„ ë§Œì¡±í•˜ë©´ ìƒˆë¡œê³ ì¹¨ í•¨
    return true;
  }, [isPlayerFormOpen, isAnnouncementFormOpen, editingPlayer, editingAnnouncement]);

  // ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸
  useEffect(() => {
    // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
    loadData();
    
    // 30ì´ˆë§ˆë‹¤ ì¡°ê±´ë¶€ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
    const interval = setInterval(() => {
      if (shouldRefresh()) {
        console.log('ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸ ì¤‘...');
        loadData();
      } else {
        console.log('ìƒˆë¡œê³ ì¹¨ ê±´ë„ˆëœ€ - ì‚¬ìš©ì í™œë™ ì¤‘');
      }
    }, 30000);
    
    return () => clearInterval(interval);
  }, [loadData, shouldRefresh]);

  // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ìƒíƒœ í‘œì‹œ
  const [lastUpdateTime, setLastUpdateTime] = useState<Date>(new Date());
  
  useEffect(() => {
    setLastUpdateTime(new Date());
  }, [userList, games, memberStats]);

  // userList ìƒíƒœê°€ ë³€ê²½ë  ë•Œ localStorageì— ì €ì¥
  useEffect(() => {
    if (userList.length > 0) {
      try {
        localStorage.setItem('adminUserList', JSON.stringify(userList));
        console.log('íšŒì› ëª©ë¡ì´ localStorageì— ì €ì¥ë¨:', userList.length, 'ëª…');
      } catch (error) {
        console.error('íšŒì› ëª©ë¡ localStorage ì €ì¥ ì‹¤íŒ¨:', error);
      }
    }
  }, [userList]);

  // games ìƒíƒœê°€ ë³€ê²½ë  ë•Œ localStorageì— ì €ì¥
  useEffect(() => {
    if (games.length > 0) {
      try {
        localStorage.setItem('adminGamesList', JSON.stringify(games));
        console.log('ê²½ê¸° ëª©ë¡ì´ localStorageì— ì €ì¥ë¨:', games.length, 'ê²½ê¸°');
      } catch (error) {
        console.error('ê²½ê¸° ëª©ë¡ localStorage ì €ì¥ ì‹¤íŒ¨:', error);
      }
    }
  }, [games]);

  // í™œë™ ë°ì´í„° ìˆ˜ì§‘ í•¨ìˆ˜
  const collectActivityData = useCallback(() => {
    try {
      // ê°¤ëŸ¬ë¦¬ ì•„ì´í…œ ë¡œë“œ
      const galleryItems = JSON.parse(localStorage.getItem('galleryItems') || '[]');
      
      const activityData = {
        // íˆ¬í‘œ í™œë™
        votes: games.flatMap(game => game.votes || []),
        
        // ê²½ê¸° ì°¸ì—¬
        gameParticipations: games.flatMap(game => game.participants || []),
        
        // ê°¤ëŸ¬ë¦¬ í™œë™ (ì¢‹ì•„ìš”, ëŒ“ê¸€)
        galleryActivities: galleryItems.flatMap((item: any) => [
          ...(item.commentsList || []),
          { 
            type: 'like', 
            userId: item.authorId, 
            date: item.uploadDate,
            itemId: item.id 
          }
        ]),
        
        // ë¡œê·¸ì¸ í™œë™ (ë”ë¯¸ ë°ì´í„°)
        loginActivities: userList.map(user => ({
          userId: user.id,
          lastLogin: user.lastLogin || new Date().toISOString(),
          loginCount: Math.floor(Math.random() * 50) + 10 // ë”ë¯¸ ë°ì´í„°
        }))
      };
      
      // í™œë™ ë°ì´í„°ë¥¼ localStorageì— ì €ì¥
      localStorage.setItem('activityData', JSON.stringify(activityData));
      
      return activityData;
    } catch (error) {
      console.error('í™œë™ ë°ì´í„° ìˆ˜ì§‘ ì‹¤íŒ¨:', error);
      return {
        votes: [],
        gameParticipations: [],
        galleryActivities: [],
        loginActivities: []
      };
    }
  }, [games, userList]);

  // ì›”ë³„ í†µê³„ ê³„ì‚° í•¨ìˆ˜
  const calculateMonthlyStats = useCallback((targetMonth: number, targetYear: number) => {
    try {
      const activityData = collectActivityData();
      const monthStart = new Date(targetYear, targetMonth - 1, 1);
      const monthEnd = new Date(targetYear, targetMonth, 0, 23, 59, 59);
      
      const monthlyActivities = {
        votes: activityData.votes.filter((vote: any) => {
          const voteDate = new Date(vote.createdAt);
          return voteDate >= monthStart && voteDate <= monthEnd;
        }),
        
        gameParticipations: activityData.gameParticipations.filter((participation: any) => {
          // ê²½ê¸° ì°¸ì—¬ëŠ” ê²½ê¸° ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ í•„í„°ë§
          const game = games.find(g => g.participants?.includes(participation));
          if (game) {
            const gameDate = new Date(game.date);
            return gameDate >= monthStart && gameDate <= monthEnd;
          }
          return false;
        }),
        
        galleryActivities: activityData.galleryActivities.filter((activity: any) => {
          const activityDate = new Date(activity.date || activity.createdAt);
          return activityDate >= monthStart && activityDate <= monthEnd;
        })
      };
      
      const uniqueUsers = new Set([
        ...monthlyActivities.votes.map((v: any) => v.userId),
        ...monthlyActivities.gameParticipations,
        ...monthlyActivities.galleryActivities.map((a: any) => a.userId)
      ]);
      
      return {
        month: `${targetYear}ë…„ ${targetMonth}ì›”`,
        totalVotes: monthlyActivities.votes.length,
        totalGameParticipations: monthlyActivities.gameParticipations.length,
        totalGalleryActivities: monthlyActivities.galleryActivities.length,
        uniqueActiveUsers: uniqueUsers.size,
        totalGames: games.filter(game => {
          const gameDate = new Date(game.date);
          return gameDate >= monthStart && gameDate <= monthEnd;
        }).length
      };
    } catch (error) {
      console.error('ì›”ë³„ í†µê³„ ê³„ì‚° ì‹¤íŒ¨:', error);
      return {
        month: `${targetYear}ë…„ ${targetMonth}ì›”`,
        totalVotes: 0,
        totalGameParticipations: 0,
        totalGalleryActivities: 0,
        uniqueActiveUsers: 0,
        totalGames: 0
      };
    }
  }, [collectActivityData, games]);

  // ì°¸ì—¬ìœ¨ ê³„ì‚° í•¨ìˆ˜
  const calculateParticipationRate = useCallback((userId: string) => {
    try {
      const activityData = collectActivityData();
      
      const userVotes = activityData.votes.filter((v: any) => v.userId === userId).length;
      const userGameParticipations = activityData.gameParticipations.filter((p: any) => p === userId).length;
      const userGalleryActivities = activityData.galleryActivities.filter((a: any) => a.userId === userId).length;
      
      const totalGames = games.length;
      const totalVoteOpportunities = games.length;
      const totalGalleryItems = JSON.parse(localStorage.getItem('galleryItems') || '[]').length;
      
      return {
        voteRate: totalVoteOpportunities > 0 ? (userVotes / totalVoteOpportunities) * 100 : 0,
        gameParticipationRate: totalGames > 0 ? (userGameParticipations / totalGames) * 100 : 0,
        overallActivityRate: (totalVoteOpportunities + totalGames + totalGalleryItems) > 0 
          ? ((userVotes + userGameParticipations + userGalleryActivities) / 
             (totalVoteOpportunities + totalGames + totalGalleryItems)) * 100 
          : 0
      };
    } catch (error) {
      console.error('ì°¸ì—¬ìœ¨ ê³„ì‚° ì‹¤íŒ¨:', error);
      return {
        voteRate: 0,
        gameParticipationRate: 0,
        overallActivityRate: 0
      };
    }
  }, [collectActivityData, games]);

  // ìƒìœ„ ì°¸ì—¬ì ë¶„ì„ í•¨ìˆ˜
  const getTopParticipants = useCallback(() => {
    try {
      const activityData = collectActivityData();
      
      const userStats = userList.map(user => {
        const participation = calculateParticipationRate(user.id);
        const totalActivities = 
          activityData.votes.filter((v: any) => v.userId === user.id).length +
          activityData.gameParticipations.filter((p: any) => p === user.id).length +
          activityData.galleryActivities.filter((a: any) => a.userId === user.id).length;
        
        return {
          userId: user.id,
          name: user.name,
          voteRate: participation.voteRate,
          gameParticipationRate: participation.gameParticipationRate,
          overallActivityRate: participation.overallActivityRate,
          totalActivities
        };
      });
      
      return userStats
        .sort((a, b) => b.overallActivityRate - a.overallActivityRate)
        .slice(0, 5); // ìƒìœ„ 5ëª…
    } catch (error) {
      console.error('ìƒìœ„ ì°¸ì—¬ì ë¶„ì„ ì‹¤íŒ¨:', error);
      return [];
    }
  }, [userList, collectActivityData, calculateParticipationRate]);

  // ê¶Œí•œ ì²´í¬ í•¨ìˆ˜
  const hasPermission = (permission: string) => {
    const userPermissions = rolePermissions[currentUserRole].permissions;
    return userPermissions.includes('all') || userPermissions.includes(permission);
  };





  // ì•Œë¦¼ ì„¤ì • ë³€ê²½ í•¸ë“¤ëŸ¬
  const handleNotificationChange = (category: string, field: string, value: any) => {
    setNotificationSettings(prev => ({
      ...prev,
      [category]: {
        ...prev[category as keyof typeof prev],
        [field]: value
      }
    }));
    setIsNotificationChanged(true);
  };

  // ì•Œë¦¼ ì„¤ì • ì €ì¥
  const handleSaveNotifications = async () => {
    try {
      localStorage.setItem('notificationSettings', JSON.stringify(notificationSettings));
      
      toast({
        title: 'ì•Œë¦¼ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤',
        description: 'ì•Œë¦¼ ì„¤ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.',
        status: 'success',
        duration: 3000,
        isClosable: true,
      });
      
      setIsNotificationChanged(false);
    } catch (error) {
      console.error('ì•Œë¦¼ ì„¤ì • ì €ì¥ ì‹¤íŒ¨:', error);
      toast({
        title: 'ì•Œë¦¼ ì„¤ì • ì €ì¥ ì‹¤íŒ¨',
        description: 'ì•Œë¦¼ ì„¤ì •ì„ ì €ì¥í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
        status: 'error',
        duration: 3000,
        isClosable: true,
      });
    }
  };

  // ì•Œë¦¼ ì„¤ì • ë¡œë“œ
  const loadNotificationSettings = () => {
    try {
      const saved = localStorage.getItem('notificationSettings');
      if (saved) {
        setNotificationSettings(JSON.parse(saved));
      }
    } catch (error) {
      console.error('ì•Œë¦¼ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
    }
  };

  // ì•Œë¦¼ ë°œì†¡ ì—”ì§„
  const sendNotification = async (notification: Omit<Notification, 'id' | 'sentAt' | 'status'>) => {
    const newNotification: Notification = {
      ...notification,
      id: Date.now().toString(),
      sentAt: new Date().toISOString(),
      status: 'PENDING'
    };

    setNotifications(prev => [newNotification, ...prev]);
    
    try {
      // 1. ì´ë©”ì¼ ì•Œë¦¼ ë°œì†¡
      if (notification.deliveryMethods.includes('email')) {
        await sendEmailNotification(newNotification);
      }

      // 2. í‘¸ì‹œ ì•Œë¦¼ ë°œì†¡
      if (notification.deliveryMethods.includes('push')) {
        await sendPushNotification(newNotification);
      }

      // 3. ì¸ì•± ì•Œë¦¼ ë°œì†¡
      if (notification.deliveryMethods.includes('inapp')) {
        await sendInAppNotification(newNotification);
      }

      // ì•Œë¦¼ ìƒíƒœë¥¼ ì„±ê³µìœ¼ë¡œ ì—…ë°ì´íŠ¸
      setNotifications(prev => 
        prev.map(n => n.id === newNotification.id ? { ...n, status: 'SENT' } : n)
      );

      // í™œë™ ë¡œê·¸ì— ì•Œë¦¼ ë°œì†¡ ê¸°ë¡
      addActivityLog(0, 'System', 'ANNOUNCEMENT_CREATE', `ì•Œë¦¼ ë°œì†¡: ${notification.title}`);

    } catch (error) {
      console.error('ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨:', error);
      
      // ì•Œë¦¼ ìƒíƒœë¥¼ ì‹¤íŒ¨ë¡œ ì—…ë°ì´íŠ¸
      setNotifications(prev => 
        prev.map(n => n.id === newNotification.id ? { ...n, status: 'FAILED' } : n)
      );
    }
  };

  // ì´ë©”ì¼ ì•Œë¦¼ ë°œì†¡
  const sendEmailNotification = async (notification: Notification) => {
    // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” Gmail API ë˜ëŠ” SendGrid ì‚¬ìš©
    console.log('ğŸ“§ ì´ë©”ì¼ ì•Œë¦¼ ë°œì†¡:', notification);
    
    // ë”ë¯¸ ì´ë©”ì¼ ë°œì†¡ ê²°ê³¼
    notification.recipients.forEach(userId => {
      const result: NotificationDeliveryResult = {
        notificationId: notification.id,
        userId,
        method: 'email',
        status: 'success',
        sentAt: new Date().toISOString()
      };
      setNotificationResults(prev => [...prev, result]);
    });
  };

  // í‘¸ì‹œ ì•Œë¦¼ ë°œì†¡
  const sendPushNotification = async (notification: Notification) => {
    // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” Firebase Cloud Messaging ì‚¬ìš©
    console.log('ğŸ“± í‘¸ì‹œ ì•Œë¦¼ ë°œì†¡:', notification);
    
    // ë”ë¯¸ í‘¸ì‹œ ë°œì†¡ ê²°ê³¼
    notification.recipients.forEach(userId => {
      const result: NotificationDeliveryResult = {
        notificationId: notification.id,
        userId,
        method: 'push',
        status: 'success',
        sentAt: new Date().toISOString()
      };
      setNotificationResults(prev => [...prev, result]);
    });
  };

  // ì¸ì•± ì•Œë¦¼ ë°œì†¡
  const sendInAppNotification = async (notification: Notification) => {
    // WebSocketì„ í†µí•œ ì‹¤ì‹œê°„ ì¸ì•± ì•Œë¦¼
    console.log('ğŸ”” ì¸ì•± ì•Œë¦¼ ë°œì†¡:', notification);
    
    // ì „ì—­ ì´ë²¤íŠ¸ ë°œìƒ (ì¸ì•± ì•Œë¦¼ìš©)
    const event = new CustomEvent('notification-received', {
      detail: { notification }
    });
    window.dispatchEvent(event);
    
    // ë”ë¯¸ ì¸ì•± ë°œì†¡ ê²°ê³¼
    notification.recipients.forEach(userId => {
      const result: NotificationDeliveryResult = {
        notificationId: notification.id,
        userId,
        method: 'inapp',
        status: 'success',
        sentAt: new Date().toISOString()
      };
      setNotificationResults(prev => [...prev, result]);
    });
  };

  // ì„ ìˆ˜ ê´€ë ¨ í•¨ìˆ˜ë“¤
  const handleAddPlayer = () => {
    if (!newPlayer.name) {
      toast({
        title: 'ì„ ìˆ˜ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”',
        status: 'warning',
        duration: 2000,
        isClosable: true,
      });
      return;
    }

    const player: Player = {
      id: Date.now().toString(),
      name: newPlayer.name!,
      position: newPlayer.position || 'MF',
      jerseyNumber: newPlayer.jerseyNumber,
      phone: newPlayer.phone,
      email: newPlayer.email,
      joinDate: newPlayer.joinDate || new Date().toISOString().split('T')[0],
      preferredPosition: newPlayer.preferredPosition || [],
      skillRating: newPlayer.skillRating || 70,
      attendanceRate: newPlayer.attendanceRate || 0,
      isActive: newPlayer.isActive !== false,
      notes: newPlayer.notes
    };

    setPlayers(prev => [...prev, player]);
    localStorage.setItem('players', JSON.stringify([...players, player]));
    
    setNewPlayer({
      name: '',
      position: 'MF',
      preferredPosition: [],
      skillRating: 70,
      attendanceRate: 0,
      isActive: true,
      joinDate: new Date().toISOString().split('T')[0]
    });
    setIsPlayerFormOpen(false);

    toast({
      title: 'ì„ ìˆ˜ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤',
      status: 'success',
      duration: 2000,
      isClosable: true,
    });
  };

  const handleEditPlayer = (player: Player) => {
    setEditingPlayer(player);
    setNewPlayer(player);
    setIsPlayerFormOpen(true);
  };

  const handleUpdatePlayer = () => {
    if (!editingPlayer || !newPlayer.name) return;

    const updatedPlayer: Player = {
      ...editingPlayer,
      ...newPlayer,
      name: newPlayer.name!,
    };

    const updatedPlayers = players.map(p => 
      p.id === editingPlayer.id ? updatedPlayer : p
    );
    
    setPlayers(updatedPlayers);
    localStorage.setItem('players', JSON.stringify(updatedPlayers));
    
    setEditingPlayer(null);
    setNewPlayer({
      name: '',
      position: 'MF',
      preferredPosition: [],
      skillRating: 70,
      attendanceRate: 0,
      isActive: true,
      joinDate: new Date().toISOString().split('T')[0]
    });
    setIsPlayerFormOpen(false);

    toast({
      title: 'ì„ ìˆ˜ ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤',
      status: 'success',
      duration: 2000,
      isClosable: true,
    });
  };

  const handleDeletePlayer = (playerId: string) => {
    const updatedPlayers = players.filter(p => p.id !== playerId);
    setPlayers(updatedPlayers);
    localStorage.setItem('players', JSON.stringify(updatedPlayers));

    toast({
      title: 'ì„ ìˆ˜ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤',
      status: 'info',
      duration: 2000,
      isClosable: true,
    });
  };

  // ì„ ìˆ˜ ë°ì´í„° ë¡œë“œ
  const loadPlayers = () => {
    try {
      const saved = localStorage.getItem('players');
      if (saved) {
        setPlayers(JSON.parse(saved));
      }
    } catch (error) {
      console.error('ì„ ìˆ˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
    }
  };

  // ê³µì§€ì‚¬í•­ ê´€ë ¨ í•¨ìˆ˜ë“¤
  const handleAddAnnouncement = () => {
    if (!newAnnouncement.title || !newAnnouncement.content) {
      toast({
        title: 'ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”',
        status: 'warning',
        duration: 2000,
        isClosable: true,
      });
      return;
    }

    const announcement: Announcement = {
      id: Date.now().toString(),
      title: newAnnouncement.title!,
      content: newAnnouncement.content!,
      type: newAnnouncement.type || 'normal',
      startDate: newAnnouncement.startDate || new Date().toISOString().split('T')[0],
      endDate: newAnnouncement.endDate || new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
      isActive: newAnnouncement.isActive !== false,
      author: user?.name || 'ê´€ë¦¬ì',
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString(),
      pinned: newAnnouncement.pinned || false
    };

    setAnnouncements(prev => [...prev, announcement]);
    localStorage.setItem('announcements', JSON.stringify([...announcements, announcement]));
    
    setNewAnnouncement({
      title: '',
      content: '',
      type: 'normal',
      startDate: new Date().toISOString().split('T')[0],
      endDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
      isActive: true,
      pinned: false
    });
    setIsAnnouncementFormOpen(false);

    toast({
      title: 'ê³µì§€ì‚¬í•­ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤',
      status: 'success',
      duration: 2000,
      isClosable: true,
    });
  };

  const handleEditAnnouncement = (announcement: Announcement) => {
    setEditingAnnouncement(announcement);
    setNewAnnouncement(announcement);
    setIsAnnouncementFormOpen(true);
  };

  const handleUpdateAnnouncement = () => {
    if (!editingAnnouncement || !newAnnouncement.title || !newAnnouncement.content) return;

    const updatedAnnouncement: Announcement = {
      ...editingAnnouncement,
      ...newAnnouncement,
      title: newAnnouncement.title!,
      content: newAnnouncement.content!,
      updatedAt: new Date().toISOString()
    };

    const updatedAnnouncements = announcements.map(a => 
      a.id === editingAnnouncement.id ? updatedAnnouncement : a
    );
    
    setAnnouncements(updatedAnnouncements);
    localStorage.setItem('announcements', JSON.stringify(updatedAnnouncements));
    
    setEditingAnnouncement(null);
    setNewAnnouncement({
      title: '',
      content: '',
      type: 'normal',
      startDate: new Date().toISOString().split('T')[0],
      endDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
      isActive: true,
      pinned: false
    });
    setIsAnnouncementFormOpen(false);

    toast({
      title: 'ê³µì§€ì‚¬í•­ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤',
      status: 'success',
      duration: 2000,
      isClosable: true,
    });
  };

  const handleDeleteAnnouncement = (announcementId: string) => {
    const updatedAnnouncements = announcements.filter(a => a.id !== announcementId);
    setAnnouncements(updatedAnnouncements);
    localStorage.setItem('announcements', JSON.stringify(updatedAnnouncements));

    toast({
      title: 'ê³µì§€ì‚¬í•­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤',
      status: 'info',
      duration: 2000,
      isClosable: true,
    });
  };

  const handleToggleAnnouncementStatus = (announcementId: string) => {
    const updatedAnnouncements = announcements.map(a => 
      a.id === announcementId ? { ...a, isActive: !a.isActive } : a
    );
    setAnnouncements(updatedAnnouncements);
    localStorage.setItem('announcements', JSON.stringify(updatedAnnouncements));
  };

  // ê³µì§€ì‚¬í•­ ë°ì´í„° ë¡œë“œ
  const loadAnnouncements = () => {
    try {
      const saved = localStorage.getItem('announcements');
      if (saved) {
        setAnnouncements(JSON.parse(saved));
      }
    } catch (error) {
      console.error('ê³µì§€ì‚¬í•­ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
    }
  };

  useEffect(() => {
    loadData();
    loadNotificationSettings();
    loadPlayers();
    loadAnnouncements();
    loadActivityLogs();
    loadVoteRecords();
    loadSuspensionRequests();
    checkVoteParticipation();
    
    // ì•Œë¦¼ ì‹œìŠ¤í…œ í™œì„±í™”
    setIsNotificationSystemActive(true);
  }, [loadData]);

  // ìë™ ì•Œë¦¼ ì²´í¬ ì‹œìŠ¤í…œ
  const checkAndSendNotifications = useCallback(() => {
    if (!isNotificationSystemActive) return;

    const now = new Date();
    
    // 1. ê²½ê¸° ì•Œë¦¼ ì²´í¬
    if (notificationSettings.gameReminder.enabled) {
      games.forEach(game => {
        const gameTime = new Date(game.date);
        const hoursUntilGame = (gameTime.getTime() - now.getTime()) / (1000 * 60 * 60);
        
        if (hoursUntilGame > 0 && hoursUntilGame <= notificationSettings.gameReminder.beforeHours) {
          // ì´ë¯¸ ë°œì†¡ëœ ì•Œë¦¼ì¸ì§€ ì²´í¬
          const existingNotification = notifications.find(n => 
            n.type === 'GAME_REMINDER' && 
            n.metadata?.gameId === game.id &&
            n.metadata?.hoursBefore === Math.floor(hoursUntilGame)
          );
          
          if (!existingNotification) {
            const recipients = getNotificationRecipients('gameReminder', game);
            
            sendNotification({
              type: 'GAME_REMINDER',
              title: 'âš½ ê²½ê¸° ì•Œë¦¼',
              message: `${game.date} ê²½ê¸°ê°€ ${Math.floor(hoursUntilGame)}ì‹œê°„ í›„ì— ì‹œì‘ë©ë‹ˆë‹¤.`,
              recipients,
              deliveryMethods: ['email', 'push', 'inapp'],
              metadata: {
                gameId: game.id,
                gameDate: game.date,
                hoursBefore: Math.floor(hoursUntilGame)
              }
            });
          }
        }
      });
    }

    // 2. íˆ¬í‘œ ì•Œë¦¼ ì²´í¬
    if (notificationSettings.voteReminder.enabled) {
      const voteDeadline = getVoteDeadline();
      const hoursUntilDeadline = voteDeadline.remainingHours;
      
      if (hoursUntilDeadline > 0 && hoursUntilDeadline <= notificationSettings.voteReminder.beforeHours) {
        const existingNotification = notifications.find(n => 
          n.type === 'VOTE_REMINDER' && 
          n.metadata?.hoursBefore === Math.floor(hoursUntilDeadline)
        );
        
        if (!existingNotification) {
          const recipients = getNotificationRecipients('voteReminder');
          
          sendNotification({
            type: 'VOTE_REMINDER',
            title: 'ğŸ—³ï¸ íˆ¬í‘œ ë§ˆê° ì•Œë¦¼',
            message: `íˆ¬í‘œê°€ ${Math.floor(hoursUntilDeadline)}ì‹œê°„ í›„ì— ë§ˆê°ë©ë‹ˆë‹¤.`,
            recipients,
            deliveryMethods: ['email', 'push', 'inapp'],
            metadata: {
              hoursBefore: Math.floor(hoursUntilDeadline)
            }
          });
        }
      }
    }
  }, [isNotificationSystemActive, notificationSettings, games, notifications, userList]);

  // ìë™ ì•Œë¦¼ ì²´í¬ (1ë¶„ë§ˆë‹¤)
  useEffect(() => {
    if (!isNotificationSystemActive) return;

    const interval = setInterval(() => {
      checkAndSendNotifications();
    }, 60000); // 1ë¶„ë§ˆë‹¤ ì²´í¬

    return () => clearInterval(interval);
  }, [isNotificationSystemActive, checkAndSendNotifications]);

  // í™œë™ ë¡œê·¸ ë¡œë“œ
  const loadActivityLogs = () => {
    try {
      const saved = localStorage.getItem('activityLogs');
      if (saved) {
        setActivityLogs(JSON.parse(saved));
      }
    } catch (error) {
      console.error('í™œë™ ë¡œê·¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
    }
  };

  // íˆ¬í‘œ ê¸°ë¡ ë¡œë“œ
  const loadVoteRecords = () => {
    try {
      const saved = localStorage.getItem('voteRecords');
      if (saved) {
        setVoteRecords(JSON.parse(saved));
      }
    } catch (error) {
      console.error('íˆ¬í‘œ ê¸°ë¡ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
    }
  };

  // ì •ì§€ í•´ì œ ìš”ì²­ ë¡œë“œ
  const loadSuspensionRequests = () => {
    try {
      const saved = localStorage.getItem('suspensionRequests');
      if (saved) {
        setSuspensionRequests(JSON.parse(saved));
      }
    } catch (error) {
      console.error('ì •ì§€ í•´ì œ ìš”ì²­ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
    }
  };

  // íˆ¬í‘œ ì°¸ì—¬ë„ ì²´í¬ ë° íšŒì› ìƒíƒœ ê´€ë¦¬
  const checkVoteParticipation = () => {
    const currentYear = new Date().getFullYear();
    const currentMonth = new Date().getMonth();
    
    userList.forEach(user => {
      if (user.role === 'MEMBER') {
        const userVotes = voteRecords.filter(v => v.userId === user.id && v.year === currentYear);
        const participatedVotes = userVotes.filter(v => v.participated);
        const totalVotes = userVotes.length;
        const consecutiveMissed = getConsecutiveMissedVotes(user.id, currentYear);
        
        // ì—°ì† 3íšŒ ë˜ëŠ” ì´ 6íšŒ ë¯¸ì°¸ì—¬ ì‹œ ê²½ê³ 
        if (consecutiveMissed >= 3 || (totalVotes > 0 && participatedVotes.length < totalVotes - 5)) {
          if (!voteWarnings.find(w => w.userId === user.id)) {
            addVoteWarning(user.id, user.name);
          }
        }
        
        // ì—°ì† 3íšŒ ë¯¸ì°¸ì—¬ ì‹œ ì •ì§€
        if (consecutiveMissed >= 3) {
          suspendMember(user.id, user.name);
        }
      }
    });
  };

  // ìë™ ì•Œë¦¼ ì²´í¬ ì‹œìŠ¤í…œ
  const checkAndSendNotifications = useCallback(() => {
    if (!isNotificationSystemActive) return;

    const now = new Date();
    
    // 1. ê²½ê¸° ì•Œë¦¼ ì²´í¬
    if (notificationSettings.gameReminder.enabled) {
      games.forEach(game => {
        const gameTime = new Date(game.date);
        const hoursUntilGame = (gameTime.getTime() - now.getTime()) / (1000 * 60 * 60);
        
        if (hoursUntilGame > 0 && hoursUntilGame <= notificationSettings.gameReminder.beforeHours) {
          // ì´ë¯¸ ë°œì†¡ëœ ì•Œë¦¼ì¸ì§€ ì²´í¬
          const existingNotification = notifications.find(n => 
            n.type === 'GAME_REMINDER' && 
            n.metadata?.gameId === game.id &&
            n.metadata?.hoursBefore === Math.floor(hoursUntilGame)
          );
          
          if (!existingNotification) {
            const recipients = getNotificationRecipients('gameReminder', game);
            
            sendNotification({
              type: 'GAME_REMINDER',
              title: 'âš½ ê²½ê¸° ì•Œë¦¼',
              message: `${game.date} ê²½ê¸°ê°€ ${Math.floor(hoursUntilGame)}ì‹œê°„ í›„ì— ì‹œì‘ë©ë‹ˆë‹¤.`,
              recipients,
              deliveryMethods: ['email', 'push', 'inapp'],
              metadata: {
                gameId: game.id,
                gameDate: game.date,
                hoursBefore: Math.floor(hoursUntilGame)
              }
            });
          }
        }
      });
    }

    // 2. íˆ¬í‘œ ì•Œë¦¼ ì²´í¬
    if (notificationSettings.voteReminder.enabled) {
      const voteDeadline = getVoteDeadline();
      const hoursUntilDeadline = voteDeadline.remainingHours;
      
      if (hoursUntilDeadline > 0 && hoursUntilDeadline <= notificationSettings.voteReminder.beforeHours) {
        const existingNotification = notifications.find(n => 
          n.type === 'VOTE_REMINDER' && 
          n.metadata?.hoursBefore === Math.floor(hoursUntilDeadline)
        );
        
        if (!existingNotification) {
          const recipients = getNotificationRecipients('voteReminder');
          
          sendNotification({
            type: 'VOTE_REMINDER',
            title: 'ğŸ—³ï¸ íˆ¬í‘œ ë§ˆê° ì•Œë¦¼',
            message: `íˆ¬í‘œê°€ ${Math.floor(hoursUntilDeadline)}ì‹œê°„ í›„ì— ë§ˆê°ë©ë‹ˆë‹¤.`,
            recipients,
            deliveryMethods: ['email', 'push', 'inapp'],
            metadata: {
              hoursBefore: Math.floor(hoursUntilDeadline)
            }
          });
        }
      }
    }
  }, [isNotificationSystemActive, notificationSettings, games, notifications, userList]);

  // ì•Œë¦¼ ìˆ˜ì‹ ì ê²°ì •
  const getNotificationRecipients = (notificationType: string, game?: any): number[] => {
    const settings = notificationSettings[notificationType as keyof typeof notificationSettings];
    
    if (!settings || !settings.enabled) return [];
    
    switch (settings.targets[0]) {
      case 'all':
        return userList.map(user => user.id);
      case 'participating':
        if (game && game.participants) {
          return game.participants.map((p: any) => p.userId);
        }
        return userList.map(user => user.id);
      case 'admin':
        return userList.filter(user => user.role === 'ADMIN' || user.role === 'SUPER_ADMIN').map(user => user.id);
      default:
        return userList.map(user => user.id);
    }
  };

  // íˆ¬í‘œ ë§ˆê°ì¼ ê³„ì‚° (ë§¤ì£¼ ìˆ˜ìš”ì¼ 17ì‹œ)
  const getVoteDeadline = () => {
    const now = new Date();
    const currentDay = now.getDay(); // 0: ì¼ìš”ì¼, 1: ì›”ìš”ì¼, ..., 3: ìˆ˜ìš”ì¼

    let daysUntilWednesday;
    if (currentDay <= 3) { // If today is Sun, Mon, Tue, Wed
      daysUntilWednesday = 3 - currentDay;
    } else { // If today is Thu, Fri, Sat
      daysUntilWednesday = 10 - currentDay; // Next Wednesday
    }

    const nextWednesday = new Date(now);
    nextWednesday.setDate(now.getDate() + daysUntilWednesday);
    nextWednesday.setHours(17, 0, 0, 0);

    return {
      text: `${nextWednesday.getMonth() + 1}ì›” ${nextWednesday.getDate()}ì¼(ìˆ˜) 17ì‹œê¹Œì§€`,
      deadline: nextWednesday,
      remainingHours: Math.max(0, (nextWednesday.getTime() - now.getTime()) / (1000 * 60 * 60))
    };
  };

  // ìˆ˜ë™ ì•Œë¦¼ ë°œì†¡ í•¨ìˆ˜ë“¤
  const sendTestNotification = () => {
    sendNotification({
      type: 'GAME_REMINDER',
      title: 'ğŸ§ª í…ŒìŠ¤íŠ¸ ì•Œë¦¼',
      message: 'ì´ê²ƒì€ í…ŒìŠ¤íŠ¸ ì•Œë¦¼ì…ë‹ˆë‹¤. ì•Œë¦¼ ì‹œìŠ¤í…œì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
      recipients: userList.map(user => user.id),
      deliveryMethods: ['email', 'push', 'inapp'],
      metadata: { isTest: true }
    });

    toast({
      title: 'í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ë°œì†¡',
      description: 'í…ŒìŠ¤íŠ¸ ì•Œë¦¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.',
      status: 'success',
      duration: 3000,
      isClosable: true,
    });
  };

  const sendVoteReminder = () => {
    const voteDeadline = getVoteDeadline();
    
    sendNotification({
      type: 'VOTE_REMINDER',
      title: 'ğŸ—³ï¸ íˆ¬í‘œ ë§ˆê° ì•Œë¦¼',
      message: `íˆ¬í‘œê°€ ${voteDeadline.text}ì— ë§ˆê°ë©ë‹ˆë‹¤. ì•„ì§ íˆ¬í‘œí•˜ì§€ ì•Šì€ íšŒì›ì€ ë¹ ë¥¸ ì‹œì¼ ë‚´ì— íˆ¬í‘œí•´ì£¼ì„¸ìš”.`,
      recipients: userList.map(user => user.id),
      deliveryMethods: ['email', 'push', 'inapp'],
      metadata: { 
        deadline: voteDeadline.deadline.toISOString(),
        isManual: true 
      }
    });

    toast({
      title: 'íˆ¬í‘œ ë§ˆê° ì•Œë¦¼ ë°œì†¡',
      description: 'íˆ¬í‘œ ë§ˆê° ì•Œë¦¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.',
      status: 'success',
      duration: 3000,
      isClosable: true,
    });
  };

  // ì—°ì† ë¯¸ì°¸ì—¬ íˆ¬í‘œ ìˆ˜ ê³„ì‚°
  const getConsecutiveMissedVotes = (userId: number, year: number): number => {
    const userVotes = voteRecords.filter(v => v.userId === userId && v.year === year);
    let consecutiveMissed = 0;
    
    for (let i = userVotes.length - 1; i >= 0; i--) {
      if (!userVotes[i].participated) {
        consecutiveMissed++;
      } else {
        break;
      }
    }
    
    return consecutiveMissed;
  };

  // íˆ¬í‘œ ê²½ê³  ì¶”ê°€
  const addVoteWarning = (userId: number, userName: string) => {
    const newWarning = {
      userId,
      userName,
      warningCount: 1,
      lastWarningDate: new Date().toISOString()
    };
    
    setVoteWarnings(prev => [...prev, newWarning]);
    localStorage.setItem('voteWarnings', JSON.stringify([...voteWarnings, newWarning]));
    
    // í™œë™ ë¡œê·¸ì— ê²½ê³  ê¸°ë¡
    addActivityLog(userId, userName, 'VOTE_WARNING', `${userName}ë‹˜ì—ê²Œ íˆ¬í‘œ ì°¸ì—¬ ê²½ê³ ê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    
    // í† ìŠ¤íŠ¸ ì•Œë¦¼
    toast({
      title: 'íˆ¬í‘œ ì°¸ì—¬ ê²½ê³ ',
      description: `${userName}ë‹˜ì—ê²Œ íˆ¬í‘œ ì°¸ì—¬ ê²½ê³ ê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.`,
      status: 'warning',
      duration: 5000,
      isClosable: true,
    });
  };

  // íšŒì› ì •ì§€
  const suspendMember = (userId: number, userName: string) => {
    const updatedUserList = userList.map(user => 
      user.id === userId ? { ...user, status: 'SUSPENDED' as const } : user
    );
    
    setUserList(updatedUserList);
    localStorage.setItem('userList', JSON.stringify(updatedUserList));
    
    // í™œë™ ë¡œê·¸ì— ì •ì§€ ê¸°ë¡
    addActivityLog(userId, userName, 'MEMBER_SUSPENDED', `${userName}ë‹˜ì´ íˆ¬í‘œ ì°¸ì—¬ ë¶€ì¡±ìœ¼ë¡œ ì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    
    // í† ìŠ¤íŠ¸ ì•Œë¦¼
    toast({
      title: 'íšŒì› ì •ì§€',
      description: `${userName}ë‹˜ì´ íˆ¬í‘œ ì°¸ì—¬ ë¶€ì¡±ìœ¼ë¡œ ì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.`,
      status: 'error',
      duration: 5000,
      isClosable: true,
    });
  };

  // í™œë™ ë¡œê·¸ ì¶”ê°€
  const addActivityLog = (userId: number, userName: string, action: ActivityLog['action'], description: string, metadata?: any) => {
    const newLog: ActivityLog = {
      id: Date.now().toString(),
      userId,
      userName,
      action,
      description,
      timestamp: new Date().toISOString(),
      metadata
    };
    
    setActivityLogs(prev => [newLog, ...prev.slice(0, 99)]); // ìµœê·¼ 100ê°œë§Œ ìœ ì§€
    localStorage.setItem('activityLogs', JSON.stringify([newLog, ...activityLogs.slice(0, 99)]));
  };

  // íˆ¬í‘œ ê¸°ë¡ ì¶”ê°€
  const addVoteRecord = (userId: number, userName: string, voteDate: string, participated: boolean) => {
    const year = new Date(voteDate).getFullYear();
    const newRecord: VoteRecord = {
      userId,
      userName,
      voteDate,
      participated,
      year
    };
    
    // ê¸°ì¡´ ê¸°ë¡ì´ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸, ì—†ìœ¼ë©´ ì¶”ê°€
    setVoteRecords(prev => {
      const filtered = prev.filter(r => !(r.userId === userId && r.voteDate === voteDate));
      return [newRecord, ...filtered];
    });
    
    // localStorage ì—…ë°ì´íŠ¸
    const updatedRecords = voteRecords.filter(r => !(r.userId === userId && r.voteDate === voteDate));
    localStorage.setItem('voteRecords', JSON.stringify([newRecord, ...updatedRecords]));
    
    // í™œë™ ë¡œê·¸ ì¶”ê°€
    const action = participated ? 'VOTE_PARTICIPATE' : 'VOTE_ABSENT';
    const description = participated ? 
      `${userName}ë‹˜ì´ ${voteDate} íˆ¬í‘œì— ì°¸ì—¬í–ˆìŠµë‹ˆë‹¤.` : 
      `${userName}ë‹˜ì´ ${voteDate} íˆ¬í‘œì— ë¶ˆì°¸í–ˆìŠµë‹ˆë‹¤.`;
    
    addActivityLog(userId, userName, action, description, { voteDate, participated });
  };

  // íˆ¬í‘œ ê¸°ë¡ ê°€ì ¸ì˜¤ê¸° (ì™¸ë¶€ì—ì„œ í˜¸ì¶œ ê°€ëŠ¥)
  const getVoteRecords = () => voteRecords;
  
  // íˆ¬í‘œ ê²½ê³  ê°€ì ¸ì˜¤ê¸° (ì™¸ë¶€ì—ì„œ í˜¸ì¶œ ê°€ëŠ¥)
  const getVoteWarnings = () => voteWarnings;

  // ì •ì§€ í•´ì œ ìš”ì²­ ìƒíƒœ
  const [suspensionRequests, setSuspensionRequests] = useState<{
    id: string;
    userId: number;
    userName: string;
    requestDate: string;
    reason: string;
    status: 'PENDING' | 'APPROVED' | 'REJECTED';
  }[]>([]);

  // ì •ì§€ í•´ì œ ìš”ì²­ ì¶”ê°€
  const addSuspensionRequest = (userId: number, userName: string, reason: string) => {
    const newRequest = {
      id: Date.now().toString(),
      userId,
      userName,
      requestDate: new Date().toISOString(),
      reason,
      status: 'PENDING' as const
    };
    
    setSuspensionRequests(prev => [...prev, newRequest]);
    localStorage.setItem('suspensionRequests', JSON.stringify([...suspensionRequests, newRequest]));
    
    // í™œë™ ë¡œê·¸ì— ìš”ì²­ ê¸°ë¡
    addActivityLog(userId, userName, 'MEMBER_STATUS_CHANGE', `${userName}ë‹˜ì´ ì •ì§€ í•´ì œë¥¼ ìš”ì²­í–ˆìŠµë‹ˆë‹¤.`);
    
    toast({
      title: 'ì •ì§€ í•´ì œ ìš”ì²­',
      description: `${userName}ë‹˜ì´ ì •ì§€ í•´ì œë¥¼ ìš”ì²­í–ˆìŠµë‹ˆë‹¤.`,
      status: 'info',
      duration: 5000,
      isClosable: true,
    });
  };

  // ì •ì§€ í•´ì œ ìš”ì²­ ìŠ¹ì¸
  const approveSuspensionRequest = (requestId: string) => {
    const request = suspensionRequests.find(r => r.id === requestId);
    if (!request) return;

    // íšŒì› ìƒíƒœë¥¼ ACTIVEë¡œ ë³€ê²½
    const updatedUserList = userList.map(user => 
      user.id === request.userId ? { ...user, status: 'ACTIVE' as const } : user
    );
    
    setUserList(updatedUserList);
    localStorage.setItem('userList', JSON.stringify(updatedUserList));
    
    // ìš”ì²­ ìƒíƒœë¥¼ ìŠ¹ì¸ìœ¼ë¡œ ë³€ê²½
    const updatedRequests = suspensionRequests.map(r => 
      r.id === requestId ? { ...r, status: 'APPROVED' as const } : r
    );
    setSuspensionRequests(updatedRequests);
    localStorage.setItem('suspensionRequests', JSON.stringify(updatedRequests));
    
    // í™œë™ ë¡œê·¸ì— ìŠ¹ì¸ ê¸°ë¡
    addActivityLog(request.userId, request.userName, 'MEMBER_STATUS_CHANGE', `${request.userName}ë‹˜ì˜ ì •ì§€ê°€ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
    
    toast({
      title: 'ì •ì§€ í•´ì œ ìŠ¹ì¸',
      description: `${request.userName}ë‹˜ì˜ ì •ì§€ê°€ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.`,
      status: 'success',
      duration: 5000,
      isClosable: true,
    });
  };

  // ì •ì§€ í•´ì œ ìš”ì²­ ê±°ì ˆ
  const rejectSuspensionRequest = (requestId: string) => {
    const request = suspensionRequests.find(r => r.id === requestId);
    if (!request) return;

    // ìš”ì²­ ìƒíƒœë¥¼ ê±°ì ˆë¡œ ë³€ê²½
    const updatedRequests = suspensionRequests.map(r => 
      r.id === requestId ? { ...r, status: 'REJECTED' as const } : r
    );
    setSuspensionRequests(updatedRequests);
    localStorage.setItem('suspensionRequests', JSON.stringify(updatedRequests));
    
    // í™œë™ ë¡œê·¸ì— ê±°ì ˆ ê¸°ë¡
    addActivityLog(request.userId, request.userName, 'MEMBER_STATUS_CHANGE', `${request.userName}ë‹˜ì˜ ì •ì§€ í•´ì œ ìš”ì²­ì´ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤.`);
    
    toast({
      title: 'ì •ì§€ í•´ì œ ê±°ì ˆ',
      description: `${request.userName}ë‹˜ì˜ ì •ì§€ í•´ì œ ìš”ì²­ì´ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤.`,
      status: 'error',
      duration: 5000,
      isClosable: true,
    });
  };

  // ì „ì—­ í•¨ìˆ˜ ë“±ë¡ (SchedulePageV2ì—ì„œ ì‚¬ìš©)
    useEffect(() => {
    (window as any).addVoteRecord = addVoteRecord;
    (window as any).getVoteRecords = getVoteRecords;
    (window as any).getVoteWarnings = getVoteWarnings;
    (window as any).addSuspensionRequest = addSuspensionRequest;
    (window as any).sendNotification = sendNotification;

    return () => {
      delete (window as any).addVoteRecord;
      delete (window as any).getVoteRecords;
      delete (window as any).getVoteWarnings;
      delete (window as any).addSuspensionRequest;
      delete (window as any).sendNotification;
    };
  }, []);

  // ë¶ˆí•„ìš”í•œ ì½”ë“œ ì œê±°

  return (
    <Box minH="100vh" bg="gray.50" pt={20}>
      <Flex minH="calc(100vh - 80px)">
        {/* ì‚¬ì´ë“œë°” */}
        <Box
          w="280px"
          bg="white"
          borderRight="1px"
          borderColor="gray.200"
          position="fixed"
          top={20}
          left={0}
          h="calc(100vh - 80px)"
          overflowY="auto"
          zIndex={10}
        >
          <VStack spacing={0} align="stretch">
            {/* ë¡œê³ /í—¤ë” */}
            <Box p={6} borderBottom="1px" borderColor="gray.200">
              <Text fontSize="3xl" fontWeight="black" color="#004ea8">
                ê´€ë¦¬ì í˜ì´ì§€
              </Text>
            </Box>

            {/* ë©”ë‰´ */}
            <VStack spacing={1} p={4}>
              <Button
                w="100%"
                justifyContent="flex-start"
                variant={selectedMenu === 'dashboard' ? 'solid' : 'ghost'}
                colorScheme={selectedMenu === 'dashboard' ? 'blue' : 'gray'}
                bg={selectedMenu === 'dashboard' ? '#004ea8' : undefined}
                color={selectedMenu === 'dashboard' ? 'white' : undefined}
                _hover={{
                  bg: selectedMenu === 'dashboard' ? '#003d7a' : undefined
                }}
                onClick={() => setSelectedMenu('dashboard')}
                leftIcon={<ViewIcon />}
              >
                ëŒ€ì‹œë³´ë“œ
              </Button>
              
              <Button
                w="100%"
                justifyContent="flex-start"
                variant={selectedMenu === 'users' ? 'solid' : 'ghost'}
                colorScheme={selectedMenu === 'users' ? 'blue' : 'gray'}
                bg={selectedMenu === 'users' ? '#004ea8' : undefined}
                color={selectedMenu === 'users' ? 'white' : undefined}
                _hover={{
                  bg: selectedMenu === 'users' ? '#003d7a' : undefined
                }}
                onClick={() => setSelectedMenu('users')}
                leftIcon={<ViewIcon />}
              >
                íšŒì› ê´€ë¦¬
              </Button>
              
              <Button
                w="100%"
                justifyContent="flex-start"
                variant={selectedMenu === 'games' ? 'solid' : 'ghost'}
                colorScheme={selectedMenu === 'games' ? 'blue' : 'gray'}
                bg={selectedMenu === 'games' ? '#004ea8' : undefined}
                color={selectedMenu === 'games' ? 'white' : undefined}
                _hover={{
                  bg: selectedMenu === 'games' ? '#003d7a' : undefined
                }}
                onClick={() => setSelectedMenu('games')}
                leftIcon={<CalendarIcon />}
              >
                ê²½ê¸° ê´€ë¦¬
              </Button>
              




              <Button
                w="100%"
                justifyContent="flex-start"
                variant={selectedMenu === 'notifications' ? 'solid' : 'ghost'}
                colorScheme={selectedMenu === 'notifications' ? 'blue' : 'gray'}
                bg={selectedMenu === 'notifications' ? '#004ea8' : undefined}
                color={selectedMenu === 'notifications' ? 'white' : undefined}
                _hover={{
                  bg: selectedMenu === 'notifications' ? '#003d7a' : undefined
                }}
                onClick={() => setSelectedMenu('notifications')}
                leftIcon={<ViewIcon />}
              >
                ì•Œë¦¼ ê´€ë¦¬
              </Button>

              <Button
                w="100%"
                justifyContent="flex-start"
                variant={selectedMenu === 'players' ? 'solid' : 'ghost'}
                colorScheme={selectedMenu === 'players' ? 'blue' : 'gray'}
                bg={selectedMenu === 'players' ? '#004ea8' : undefined}
                color={selectedMenu === 'players' ? 'white' : undefined}
                _hover={{
                  bg: selectedMenu === 'players' ? '#003d7a' : undefined
                }}
                onClick={() => setSelectedMenu('players')}
                leftIcon={<InfoIcon />}
              >
                ì„ ìˆ˜ ê´€ë¦¬
              </Button>

              <Button
                w="100%"
                justifyContent="flex-start"
                variant={selectedMenu === 'analytics' ? 'solid' : 'ghost'}
                colorScheme={selectedMenu === 'analytics' ? 'blue' : 'gray'}
                bg={selectedMenu === 'analytics' ? '#004ea8' : undefined}
                color={selectedMenu === 'analytics' ? 'white' : undefined}
                _hover={{
                  bg: selectedMenu === 'analytics' ? '#003d7a' : undefined
                }}
                onClick={() => setSelectedMenu('analytics')}
                leftIcon={<ViewIcon />}
              >
                í™œë™ ë¶„ì„
              </Button>

              <Button
                w="100%"
                justifyContent="flex-start"
                variant={selectedMenu === 'announcements' ? 'solid' : 'ghost'}
                colorScheme={selectedMenu === 'announcements' ? 'blue' : 'gray'}
                bg={selectedMenu === 'announcements' ? '#004ea8' : undefined}
                color={selectedMenu === 'announcements' ? 'white' : undefined}
                _hover={{
                  bg: selectedMenu === 'announcements' ? '#003d7a' : undefined
                }}
                onClick={() => setSelectedMenu('announcements')}
                leftIcon={<InfoIcon />}
              >
                ê³µì§€ ê´€ë¦¬
              </Button>
            </VStack>
          </VStack>
        </Box>

        {/* ë©”ì¸ ì½˜í…ì¸  */}
        <Box 
          flex={1} 
          ml="280px"
          p={8} 
          pt={8}
          w="calc(100vw - 280px)"
          minW="calc(100vw - 280px)"
          maxW="calc(100vw - 280px)"
        >
          {loading ? (
            <Flex justify="center" align="center" h="50vh">
              <VStack spacing={4}>
                <Spinner size="xl" color="blue.500" />
                <Text>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</Text>
              </VStack>
            </Flex>
          ) : (
            <>
              {/* ëŒ€ì‹œë³´ë“œ */}
              {selectedMenu === 'dashboard' && (
                <VStack spacing={8} align="stretch" w="100%">
                  {/* ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ìƒíƒœ */}
                  <Flex justify="space-between" align="center">
                    <Text fontSize="2xl" fontWeight="bold" color="#004ea8">ğŸ“Š ì‹¤ì‹œê°„ í†µê³„ ëŒ€ì‹œë³´ë“œ</Text>
                    <HStack spacing={2}>
                      <Box 
                        w={2} 
                        h={2} 
                        bg={shouldRefresh() ? "green.500" : "yellow.500"} 
                        borderRadius="full" 
                      />
                      <Text fontSize="sm" color="gray.600">
                        {shouldRefresh() ? "ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì¤‘" : "ì‚¬ìš©ì í™œë™ ì¤‘"}
                      </Text>
                      <Text fontSize="xs" color="gray.500">
                        ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: {lastUpdateTime.toLocaleTimeString('ko-KR')}
                      </Text>
                    </HStack>
                  </Flex>
                  {/* í•µì‹¬ í†µê³„ ì¹´ë“œ */}
                  <SimpleGrid columns={{ base: 1, md: 2, lg: 4 }} spacing={4} w="100%">
                    <Card bg="blue.50" border="1px solid" borderColor="blue.200" shadow="sm">
                      <CardBody p={4}>
                        <Stat>
                          <HStack justify="space-between" align="center" mb={2}>
                            <StatLabel color="blue.800" fontSize="md" fontWeight="medium">
                              ğŸ‘¥ ì „ì²´ íšŒì›
                            </StatLabel>
                            <StatNumber color="#495057" fontWeight="bold" fontSize="2xl">{userList.length || 0}</StatNumber>
                          </HStack>
                          <StatHelpText color="blue.800" fontSize="sm" fontWeight="normal">
                            <StatArrow type="increase" />
                            {userList.filter(u => u.status === 'ACTIVE').length}ëª… í™œì„±
                          </StatHelpText>
                        </Stat>
                      </CardBody>
                    </Card>
                    
                    <Card bg="blue.50" border="1px solid" borderColor="blue.200" shadow="sm">
                      <CardBody p={4}>
                        <Stat>
                          <HStack justify="space-between" align="center" mb={2}>
                            <StatLabel color="green.800" fontSize="md" fontWeight="medium">
                              âš½ ì´ ê²½ê¸°ìˆ˜
                            </StatLabel>
                            <StatNumber color="#495057" fontWeight="bold" fontSize="2xl">{games.length || 0}</StatNumber>
                          </HStack>
                          <StatHelpText color="green.800" fontSize="sm" fontWeight="normal">
                            <StatArrow type="increase" />
                            ì´ë²ˆ ë‹¬ {games.filter(g => {
                              const gameDate = new Date(g.date);
                              const now = new Date();
                              return gameDate.getMonth() === now.getMonth() && gameDate.getFullYear() === now.getFullYear();
                            }).length}ê²½ê¸°
                          </StatHelpText>
                        </Stat>
                      </CardBody>
                    </Card>
                    
                    <Card bg="blue.50" border="1px solid" borderColor="blue.200" shadow="sm">
                      <CardBody p={4}>
                        <Stat>
                          <HStack justify="space-between" align="center" mb={2}>
                            <StatLabel color="purple.800" fontSize="md" fontWeight="medium">
                              ğŸ†• ì‹ ê·œ ê°€ì…
                            </StatLabel>
                            <StatNumber color="#495057" fontWeight="bold" fontSize="2xl">{userList.filter(u => {
                              if (!u.createdAt) return false;
                              const created = new Date(u.createdAt);
                              const weekAgo = new Date();
                              weekAgo.setDate(weekAgo.getDate() - 7);
                              return created >= weekAgo;
                            }).length}</StatNumber>
                          </HStack>
                          <StatHelpText color="purple.800" fontSize="sm" fontWeight="normal">
                            <HStack spacing={2} align="center">
                              <StatArrow type="increase" />
                              <Text color="purple.800" fontWeight="semibold">ìµœê·¼ 7ì¼</Text>
                            </HStack>
                          </StatHelpText>
                        </Stat>
                      </CardBody>
                    </Card>
                    
                    <Card bg="blue.50" border="1px solid" borderColor="blue.200" shadow="sm">
                      <CardBody p={4}>
                        <Stat>
                          <HStack justify="space-between" align="center" mb={2}>
                            <StatLabel color="orange.800" fontSize="md" fontWeight="medium">
                              ğŸ‘‘ ê´€ë¦¬ì
                            </StatLabel>
                            <StatNumber color="#495057" fontWeight="bold" fontSize="2xl">{userList.filter(u => u.role === 'ADMIN' || u.role === 'SUPER_ADMIN').length}</StatNumber>
                          </HStack>
                          <StatHelpText color="orange.800" fontSize="sm" fontWeight="normal">
                            <StatArrow type="increase" />
                            ìŠˆí¼ê´€ë¦¬ì {userList.filter(u => u.role === 'SUPER_ADMIN').length}ëª…
                          </StatHelpText>
                        </Stat>
                      </CardBody>
                    </Card>
                  </SimpleGrid>

                  {/* ìƒì„¸ í†µê³„ ì¹´ë“œ */}
                  <SimpleGrid columns={{ base: 1, md: 2, lg: 3 }} spacing={6} w="100%">
                    <Card>
                      <CardBody>
                        <VStack align="stretch" spacing={4}>
                          <Text fontSize="lg" fontWeight="bold" color="#004ea8">ğŸ“Š íšŒì› í˜„í™©</Text>
                          <VStack spacing={2} align="stretch">
                            <Flex justify="space-between">
                              <Text color="gray.600">í™œì„± íšŒì›</Text>
                              <Text fontWeight="bold">{userList.filter(u => u.status === 'ACTIVE').length}ëª…</Text>
                            </Flex>
                            <Flex justify="space-between">
                              <Text color="gray.600">ë¹„í™œì„± íšŒì›</Text>
                              <Text fontWeight="bold">{userList.filter(u => u.status === 'INACTIVE').length}ëª…</Text>
                            </Flex>
                            <Flex justify="space-between">
                              <Text color="gray.600">ì •ì§€ëœ íšŒì›</Text>
                              <Text fontWeight="bold">{userList.filter(u => u.status === 'SUSPENDED').length}ëª…</Text>
                            </Flex>
                          </VStack>
                        </VStack>
                      </CardBody>
                    </Card>

                    <Card>
                      <CardBody>
                        <VStack align="stretch" spacing={4}>
                          <Text fontSize="lg" fontWeight="bold" color="#004ea8">ğŸ† ê²½ê¸° í†µê³„</Text>
                          <VStack spacing={2} align="stretch">
                            <Flex justify="space-between">
                              <Text color="gray.600">ì´ë²ˆ ë‹¬ ê²½ê¸°</Text>
                              <Text fontWeight="bold">{games.filter(g => {
                                const gameDate = new Date(g.date);
                                const now = new Date();
                                return gameDate.getMonth() === now.getMonth() && gameDate.getFullYear() === now.getFullYear();
                              }).length}íšŒ</Text>
                            </Flex>
                            <Flex justify="space-between">
                              <Text color="gray.600">ì§€ë‚œ ë‹¬ ê²½ê¸°</Text>
                              <Text fontWeight="bold">{games.filter(g => {
                                const gameDate = new Date(g.date);
                                const now = new Date();
                                const lastMonth = new Date(now.getFullYear(), now.getMonth() - 1);
                                return gameDate.getMonth() === lastMonth.getMonth() && gameDate.getFullYear() === lastMonth.getFullYear();
                              }).length}íšŒ</Text>
                            </Flex>
                            <Flex justify="space-between">
                              <Text color="gray.600">ì˜¬í•´ ì´ ê²½ê¸°</Text>
                              <Text fontWeight="bold">{games.filter(g => {
                                const gameDate = new Date(g.date);
                                const now = new Date();
                                return gameDate.getFullYear() === now.getFullYear();
                              }).length}íšŒ</Text>
                            </Flex>
                          </VStack>
                        </VStack>
                      </CardBody>
                    </Card>

                    <Card>
                      <CardBody>
                        <VStack align="stretch" spacing={4}>
                          <Text fontSize="lg" fontWeight="bold" color="#004ea8">ğŸ‘¥ ê¶Œí•œë³„ í˜„í™©</Text>
                          <VStack spacing={2} align="stretch">
                            <Flex justify="space-between">
                              <Text color="gray.600">ìŠˆí¼ê´€ë¦¬ì</Text>
                              <Text fontWeight="bold" color="red.500">{userList.filter(u => u.role === 'SUPER_ADMIN').length}ëª…</Text>
                            </Flex>
                            <Flex justify="space-between">
                              <Text color="gray.600">ê´€ë¦¬ì</Text>
                              <Text fontWeight="bold" color="blue.500">{userList.filter(u => u.role === 'ADMIN').length}ëª…</Text>
                            </Flex>
                            <Flex justify="space-between">
                              <Text color="gray.600">ì¼ë°˜ íšŒì›</Text>
                              <Text fontWeight="bold" color="gray.500">{userList.filter(u => u.role === 'MEMBER').length}ëª…</Text>
                            </Flex>
                          </VStack>
                        </VStack>
                      </CardBody>
                    </Card>

                    <Card>
                      <CardBody>
                        <VStack align="stretch" spacing={4}>
                          <Text fontSize="lg" fontWeight="bold" color="#004ea8">âš ï¸ íˆ¬í‘œ ê²½ê³  í˜„í™©</Text>
                          {voteWarnings.length === 0 ? (
                            <Text color="gray.600" fontSize="sm">ê²½ê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</Text>
                          ) : (
                            <VStack spacing={2} align="stretch">
                              {voteWarnings.map((warning) => (
                                <Flex key={warning.userId} justify="space-between" align="center">
                                  <VStack align="flex-start" spacing={1}>
                                    <Text color="gray.700" fontWeight="medium">{warning.userName}</Text>
                                    <Text color="gray.500" fontSize="xs">
                                      ê²½ê³ ì¼: {new Date(warning.lastWarningDate).toLocaleDateString('ko-KR')}
                                    </Text>
                                  </VStack>
                                  <Badge colorScheme="orange" size="sm">
                                    ê²½ê³  {warning.warningCount}íšŒ
                                  </Badge>
                                </Flex>
                              ))}
                            </VStack>
                          )}
                        </VStack>
                      </CardBody>
                    </Card>
                  </SimpleGrid>

                  {/* ìµœê·¼ í™œë™ */}
                  <Card w="100%">
                    <CardBody>
                      <VStack align="stretch" spacing={4}>
                        <HStack justify="space-between" align="center">
                          <Text fontSize="xl" fontWeight="bold" color="#004ea8">ğŸ“Š ìµœê·¼ í™œë™</Text>
                          <HStack spacing={2}>
                            <Button
                              size="sm"
                              colorScheme="blue"
                              variant="outline"
                              onClick={() => setActivityLogs([])}
                            >
                              ë¡œê·¸ ì´ˆê¸°í™”
                            </Button>
                          </HStack>
                        </HStack>
                        
                        {activityLogs.length === 0 ? (
                          <Text color="gray.600">ì•„ì§ í™œë™ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</Text>
                        ) : (
                          <VStack spacing={3} align="stretch" maxH="400px" overflowY="auto">
                            {activityLogs.slice(0, 20).map((log) => (
                              <Box
                                key={log.id}
                                p={3}
                                border="1px solid"
                                borderColor="gray.200"
                                borderRadius="md"
                                bg="gray.50"
                              >
                                <HStack justify="space-between" align="flex-start">
                                  <VStack align="flex-start" spacing={1} flex={1}>
                                    <HStack spacing={2}>
                                      <Badge
                                        colorScheme={
                                          log.action === 'MEMBER_SUSPENDED' ? 'red' :
                                          log.action === 'VOTE_WARNING' ? 'orange' :
                                          log.action === 'LOGIN' ? 'green' :
                                          log.action === 'VOTE_PARTICIPATE' ? 'blue' :
                                          'gray'
                                        }
                                        size="sm"
                                      >
                                        {log.action === 'LOGIN' ? 'ë¡œê·¸ì¸' :
                                         log.action === 'LOGOUT' ? 'ë¡œê·¸ì•„ì›ƒ' :
                                         log.action === 'GAME_JOIN' ? 'ê²½ê¸°ì°¸ì—¬' :
                                         log.action === 'GAME_CANCEL' ? 'ê²½ê¸°ì·¨ì†Œ' :
                                         log.action === 'VOTE_PARTICIPATE' ? 'íˆ¬í‘œì°¸ì—¬' :
                                         log.action === 'VOTE_ABSENT' ? 'íˆ¬í‘œë¶ˆì°¸' :
                                         log.action === 'ANNOUNCEMENT_CREATE' ? 'ê³µì§€ì‘ì„±' :
                                         log.action === 'ANNOUNCEMENT_EDIT' ? 'ê³µì§€ìˆ˜ì •' :
                                         log.action === 'MEMBER_STATUS_CHANGE' ? 'ìƒíƒœë³€ê²½' :
                                         log.action === 'VOTE_WARNING' ? 'íˆ¬í‘œê²½ê³ ' :
                                         log.action === 'MEMBER_SUSPENDED' ? 'íšŒì›ì •ì§€' : 'ê¸°íƒ€'}
                                      </Badge>
                                      <Text fontSize="sm" color="gray.500">
                                        {new Date(log.timestamp).toLocaleString('ko-KR')}
                                      </Text>
                                    </HStack>
                                    <Text fontSize="sm" fontWeight="medium">
                                      {log.userName}
                                    </Text>
                                    <Text fontSize="sm" color="gray.700">
                                      {log.description}
                                    </Text>
                                  </VStack>
                                </HStack>
                              </Box>
                            ))}
                          </VStack>
                        )}
                      </VStack>
                    </CardBody>
                  </Card>

                  {/* ì •ì§€ í•´ì œ ìš”ì²­ ê´€ë¦¬ */}
                  <Card w="100%">
                    <CardBody>
                      <VStack align="stretch" spacing={4}>
                        <HStack justify="space-between" align="center">
                          <Text fontSize="xl" fontWeight="bold" color="#004ea8">ğŸ”“ ì •ì§€ í•´ì œ ìš”ì²­ ê´€ë¦¬</Text>
                          <Badge colorScheme="red" size="lg">
                            {suspensionRequests.filter(r => r.status === 'PENDING').length}ê±´ ëŒ€ê¸°
                          </Badge>
                        </HStack>
                        
                        {suspensionRequests.length === 0 ? (
                          <Text color="gray.600">ì •ì§€ í•´ì œ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</Text>
                        ) : (
                          <VStack spacing={3} align="stretch" maxH="400px" overflowY="auto">
                            {suspensionRequests
                              .filter(r => r.status === 'PENDING')
                              .map((request) => (
                                <Box
                                  key={request.id}
                                  p={4}
                                  border="1px solid"
                                  borderColor="orange.200"
                                  borderRadius="md"
                                  bg="orange.50"
                                >
                                  <VStack align="stretch" spacing={3}>
                                    <HStack justify="space-between" align="center">
                                      <Text fontSize="lg" fontWeight="bold" color="orange.800">
                                        {request.userName}
                                      </Text>
                                      <Badge colorScheme="orange" size="sm">
                                        ëŒ€ê¸°ì¤‘
                                      </Badge>
                                    </HStack>
                                    
                                    <Text fontSize="sm" color="gray.700">
                                      <strong>ìš”ì²­ ì‚¬ìœ :</strong> {request.reason}
                                    </Text>
                                    
                                    <Text fontSize="xs" color="gray.500">
                                      ìš”ì²­ì¼: {new Date(request.requestDate).toLocaleDateString('ko-KR')}
                                    </Text>
                                    
                                    <HStack spacing={2} justify="flex-end">
                                      <Button
                                        size="sm"
                                        colorScheme="green"
                                        onClick={() => approveSuspensionRequest(request.id)}
                                      >
                                        ìŠ¹ì¸
                                      </Button>
                                      <Button
                                        size="sm"
                                        colorScheme="red"
                                        variant="outline"
                                        onClick={() => rejectSuspensionRequest(request.id)}
                                      >
                                        ê±°ì ˆ
                                      </Button>
                                    </HStack>
                                  </VStack>
                                </Box>
                              ))}
                            
                            {/* ì²˜ë¦¬ëœ ìš”ì²­ë“¤ */}
                            {suspensionRequests.filter(r => r.status !== 'PENDING').length > 0 && (
                              <>
                                <Divider />
                                <Text fontSize="md" fontWeight="bold" color="gray.600">
                                  ì²˜ë¦¬ëœ ìš”ì²­
                                </Text>
                                {suspensionRequests
                                  .filter(r => r.status !== 'PENDING')
                                  .map((request) => (
                                    <Box
                                      key={request.id}
                                      p={3}
                                      border="1px solid"
                                      borderColor={request.status === 'APPROVED' ? 'green.200' : 'red.200'}
                                      borderRadius="md"
                                      bg={request.status === 'APPROVED' ? 'green.50' : 'red.50'}
                                    >
                                      <HStack justify="space-between" align="center">
                                        <VStack align="flex-start" spacing={1} flex={1}>
                                          <HStack spacing={2}>
                                            <Text fontSize="sm" fontWeight="medium">
                                              {request.userName}
                                            </Text>
                                            <Badge
                                              colorScheme={request.status === 'APPROVED' ? 'green' : 'red'}
                                              size="sm"
                                            >
                                              {request.status === 'APPROVED' ? 'ìŠ¹ì¸ë¨' : 'ê±°ì ˆë¨'}
                                            </Badge>
                                          </HStack>
                                          <Text fontSize="xs" color="gray.500">
                                            {new Date(request.requestDate).toLocaleDateString('ko-KR')}
                                          </Text>
                                        </VStack>
                                      </HStack>
                                    </Box>
                                  ))}
                              </>
                            )}
                          </VStack>
                        )}
                      </VStack>
                    </CardBody>
                  </Card>
                </VStack>
              )}

              {/* íšŒì› ê´€ë¦¬ */}
              {selectedMenu === 'users' && hasPermission('member_management') && (
                <Box w="100%">
                          <MemberManagement 
          userList={userList} 
          onUserListChange={(users: ExtendedMember[]) => setUserList(users)} 
        />
                </Box>
              )}
              
              {/* ê²½ê¸° ê´€ë¦¬ */}
              {selectedMenu === 'games' && hasPermission('game_management') && (
                <Box w="100%">
                  <GameManagement 
                    games={games} 
                    onGamesChange={setGames}
                    userList={userList}
                    onGameDataChanged={() => {
                      // SchedulePageV2ì— ê²½ê¸° ë°ì´í„° ë³€ê²½ ì•Œë¦¼
                      // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ì´ë‚˜ ì´ë²¤íŠ¸ë¥¼ í†µí•´ ë™ê¸°í™”
                      window.dispatchEvent(new CustomEvent('gameDataChanged'));
                    }}
                  />
                </Box>
              )}
              
              {/* ì´ë²ˆì£¼ ì¼ì • */}
              {selectedMenu === 'this-week-schedules' && hasPermission('game_management') && (
                <Box w="100%">
                  <ThisWeekScheduleManagement 
                    schedules={thisWeekSchedules} 
                    onSchedulesChange={setThisWeekSchedules} 
                  />
                </Box>
              )}



              {/* ì•Œë¦¼ ê´€ë¦¬ */}
              {selectedMenu === 'notifications' && hasPermission('all') && (
                <VStack spacing={8} align="stretch" w="100%">
                  <Flex justify="space-between" align="center">
                    <Text fontSize="2xl" fontWeight="bold" color="#004ea8">ğŸ”” ì•Œë¦¼ ê´€ë¦¬</Text>
                    <Button
                      colorScheme="blue"
                      bg="#004ea8"
                      _hover={{ bg: '#003d7a' }}
                      onClick={handleSaveNotifications}
                      isDisabled={!isNotificationChanged}
                    >
                      ì•Œë¦¼ ì„¤ì • ì €ì¥
                    </Button>
                  </Flex>

                  {/* ì•Œë¦¼ ì‹œìŠ¤í…œ ìƒíƒœ */}
                  <Card w="100%">
                    <CardBody>
                      <VStack spacing={4} align="stretch">
                        <HStack justify="space-between" align="center">
                          <Text fontSize="lg" fontWeight="bold" color="#004ea8">ğŸ“Š ì•Œë¦¼ ì‹œìŠ¤í…œ ìƒíƒœ</Text>
                          <Switch
                            isChecked={isNotificationSystemActive}
                            onChange={(e) => setIsNotificationSystemActive(e.target.checked)}
                            colorScheme="green"
                          />
                        </HStack>
                        
                        <HStack spacing={4}>
                          <Badge colorScheme={isNotificationSystemActive ? 'green' : 'red'} size="lg">
                            {isNotificationSystemActive ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}
                          </Badge>
                          <Text fontSize="sm" color="gray.600">
                            {isNotificationSystemActive ? 'ìë™ ì•Œë¦¼ì´ í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤' : 'ìë™ ì•Œë¦¼ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤'}
                          </Text>
                        </HStack>
                      </VStack>
                    </CardBody>
                  </Card>

                  <SimpleGrid columns={{ base: 1, lg: 2 }} spacing={8} w="100%">
                    {/* ê²½ê¸° ì•Œë¦¼ ì„¤ì • */}
                    <Card>
                      <CardBody>
                        <VStack spacing={6} align="stretch">
                          <HStack spacing={3}>
                            <Icon as={CalendarIcon} color="#004ea8" boxSize={5} />
                            <Text fontSize="lg" fontWeight="bold" color="#004ea8">ê²½ê¸° ì•Œë¦¼</Text>
                            <Badge colorScheme={notificationSettings.gameReminder.enabled ? 'green' : 'gray'}>
                              {notificationSettings.gameReminder.enabled ? 'í™œì„±' : 'ë¹„í™œì„±'}
                            </Badge>
                          </HStack>
                          <Divider />
                          
                          <FormControl display="flex" alignItems="center">
                            <FormLabel mb="0" color="gray.700" fontWeight="bold">ê²½ê¸° ì•Œë¦¼ í™œì„±í™”</FormLabel>
                            <Switch
                              isChecked={notificationSettings.gameReminder.enabled}
                              onChange={(e) => handleNotificationChange('gameReminder', 'enabled', e.target.checked)}
                              colorScheme="blue"
                            />
                          </FormControl>

                          {notificationSettings.gameReminder.enabled && (
                            <>
                              <FormControl>
                                <FormLabel color="gray.700" fontWeight="bold">ì•Œë¦¼ ì „ì†¡ ì‹œê°„</FormLabel>
                                <HStack>
                                  <NumberInput
                                    value={notificationSettings.gameReminder.beforeHours}
                                    onChange={(_, value) => handleNotificationChange('gameReminder', 'beforeHours', value)}
                                    min={1}
                                    max={168}
                                    w="120px"
                                  >
                                    <NumberInputField />
                                    <NumberInputStepper>
                                      <NumberIncrementStepper />
                                      <NumberDecrementStepper />
                                    </NumberInputStepper>
                                  </NumberInput>
                                  <Text color="gray.600">ì‹œê°„ ì „</Text>
                                </HStack>
                              </FormControl>

                              <FormControl>
                                <FormLabel color="gray.700" fontWeight="bold">ì•Œë¦¼ ëŒ€ìƒ</FormLabel>
                                <Select
                                  value={notificationSettings.gameReminder.targets[0]}
                                  onChange={(e) => handleNotificationChange('gameReminder', 'targets', [e.target.value])}
                                  focusBorderColor="#004ea8"
                                >
                                  <option value="all">ì „ì²´ íšŒì›</option>
                                  <option value="participating">ì°¸ê°€ íšŒì›ë§Œ</option>
                                  <option value="admin">ê´€ë¦¬ìë§Œ</option>
                                </Select>
                              </FormControl>
                            </>
                          )}
                        </VStack>
                      </CardBody>
                    </Card>

                    {/* íˆ¬í‘œ ì•Œë¦¼ ì„¤ì • */}
                    <Card>
                      <CardBody>
                        <VStack spacing={6} align="stretch">
                          <HStack spacing={3}>
                            <Icon as={ViewIcon} color="#004ea8" boxSize={5} />
                            <Text fontSize="lg" fontWeight="bold" color="#004ea8">íˆ¬í‘œ ì•Œë¦¼</Text>
                            <Badge colorScheme={notificationSettings.voteReminder.enabled ? 'green' : 'gray'}>
                              {notificationSettings.voteReminder.enabled ? 'í™œì„±' : 'ë¹„í™œì„±'}
                            </Badge>
                          </HStack>
                          <Divider />

                          <FormControl display="flex" alignItems="center">
                            <FormLabel mb="0" color="gray.700" fontWeight="bold">íˆ¬í‘œ ì•Œë¦¼ í™œì„±í™”</FormLabel>
                            <Switch
                              isChecked={notificationSettings.voteReminder.enabled}
                              onChange={(e) => handleNotificationChange('voteReminder', 'enabled', e.target.checked)}
                              colorScheme="blue"
                            />
                          </FormControl>

                          {notificationSettings.voteReminder.enabled && (
                            <>
                              <FormControl>
                                <FormLabel color="gray.700" fontWeight="bold">ì•Œë¦¼ ì „ì†¡ ì‹œê°„</FormLabel>
                                <HStack>
                                  <NumberInput
                                    value={notificationSettings.voteReminder.beforeHours}
                                    onChange={(_, value) => handleNotificationChange('voteReminder', 'beforeHours', value)}
                                    min={1}
                                    max={72}
                                    w="120px"
                                  >
                                    <NumberInputField />
                                    <NumberInputStepper>
                                      <NumberIncrementStepper />
                                      <NumberDecrementStepper />
                                    </NumberInputStepper>
                                  </NumberInput>
                                  <Text color="gray.600">ì‹œê°„ ì „</Text>
                                </HStack>
                              </FormControl>

                              <FormControl>
                                <FormLabel color="gray.700" fontWeight="bold">ì•Œë¦¼ ëŒ€ìƒ</FormLabel>
                                <Select
                                  value={notificationSettings.voteReminder.targets[0]}
                                  onChange={(e) => handleNotificationChange('voteReminder', 'targets', [e.target.value])}
                                  focusBorderColor="#004ea8"
                                >
                                  <option value="all">ì „ì²´ íšŒì›</option>
                                  <option value="admin">ê´€ë¦¬ìë§Œ</option>
                                </Select>
                              </FormControl>
                            </>
                          )}
                        </VStack>
                      </CardBody>
                    </Card>

                    {/* ì‹ ê·œ íšŒì› ì•Œë¦¼ */}
                    <Card>
                      <CardBody>
                        <VStack spacing={6} align="stretch">
                          <HStack spacing={3}>
                            <Icon as={InfoIcon} color="#004ea8" boxSize={5} />
                            <Text fontSize="lg" fontWeight="bold" color="#004ea8">ì‹ ê·œ íšŒì› ì•Œë¦¼</Text>
                            <Badge colorScheme={notificationSettings.newMemberNotification.enabled ? 'green' : 'gray'}>
                              {notificationSettings.newMemberNotification.enabled ? 'í™œì„±' : 'ë¹„í™œì„±'}
                            </Badge>
                          </HStack>
                          <Divider />

                          <FormControl display="flex" alignItems="center">
                            <FormLabel mb="0" color="gray.700" fontWeight="bold">ì‹ ê·œ íšŒì› ì•Œë¦¼ í™œì„±í™”</FormLabel>
                            <Switch
                              isChecked={notificationSettings.newMemberNotification.enabled}
                              onChange={(e) => handleNotificationChange('newMemberNotification', 'enabled', e.target.checked)}
                              colorScheme="blue"
                            />
                          </FormControl>

                          {notificationSettings.newMemberNotification.enabled && (
                            <FormControl>
                              <FormLabel color="gray.700" fontWeight="bold">ì•Œë¦¼ ëŒ€ìƒ</FormLabel>
                              <Select
                                value={notificationSettings.newMemberNotification.targets[0]}
                                onChange={(e) => handleNotificationChange('newMemberNotification', 'targets', [e.target.value])}
                                focusBorderColor="#004ea8"
                              >
                                <option value="admin">ê´€ë¦¬ìë§Œ</option>
                                <option value="all">ì „ì²´ íšŒì›</option>
                              </Select>
                            </FormControl>
                          )}
                        </VStack>
                      </CardBody>
                    </Card>

                    {/* ê²½ê¸° ê²°ê³¼ ì•Œë¦¼ */}
                    <Card>
                      <CardBody>
                        <VStack spacing={6} align="stretch">
                          <HStack spacing={3}>
                            <Icon as={SettingsIcon} color="#004ea8" boxSize={5} />
                            <Text fontSize="lg" fontWeight="bold" color="#004ea8">ê²½ê¸° ê²°ê³¼ ì•Œë¦¼</Text>
                            <Badge colorScheme={notificationSettings.gameResultNotification.enabled ? 'green' : 'gray'}>
                              {notificationSettings.gameResultNotification.enabled ? 'í™œì„±' : 'ë¹„í™œì„±'}
                            </Badge>
                          </HStack>
                          <Divider />

                          <FormControl display="flex" alignItems="center">
                            <FormLabel mb="0" color="gray.700" fontWeight="bold">ê²½ê¸° ê²°ê³¼ ì•Œë¦¼ í™œì„±í™”</FormLabel>
                            <Switch
                              isChecked={notificationSettings.gameResultNotification.enabled}
                              onChange={(e) => handleNotificationChange('gameResultNotification', 'enabled', e.target.checked)}
                              colorScheme="blue"
                            />
                          </FormControl>

                          {notificationSettings.gameResultNotification.enabled && (
                            <FormControl>
                              <FormLabel color="gray.700" fontWeight="bold">ì•Œë¦¼ ëŒ€ìƒ</FormLabel>
                              <Select
                                value={notificationSettings.gameResultNotification.targets[0]}
                                onChange={(e) => handleNotificationChange('gameResultNotification', 'targets', [e.target.value])}
                                focusBorderColor="#004ea8"
                              >
                                <option value="all">ì „ì²´ íšŒì›</option>
                                <option value="participating">ì°¸ê°€ íšŒì›ë§Œ</option>
                                <option value="admin">ê´€ë¦¬ìë§Œ</option>
                              </Select>
                            </FormControl>
                          )}
                        </VStack>
                      </CardBody>
                    </Card>
                  </SimpleGrid>

                  {/* ì•Œë¦¼ ì„¤ì • ìš”ì•½ */}
                  <Card w="100%">
                    <CardBody>
                      <VStack spacing={4} align="stretch">
                        <Text fontSize="lg" fontWeight="bold" color="#004ea8">ğŸ“‹ ì•Œë¦¼ ì„¤ì • ìš”ì•½</Text>
                        <Divider />
                        <SimpleGrid columns={{ base: 1, md: 2 }} spacing={4}>
                          <Box>
                            <Text fontSize="sm" color="gray.600" fontWeight="bold">ê²½ê¸° ì•Œë¦¼</Text>
                            <Text>
                              {notificationSettings.gameReminder.enabled 
                                ? `í™œì„± - ${notificationSettings.gameReminder.beforeHours}ì‹œê°„ ì „ ì•Œë¦¼` 
                                : 'ë¹„í™œì„±'}
                            </Text>
                          </Box>
                          <Box>
                            <Text fontSize="sm" color="gray.600" fontWeight="bold">íˆ¬í‘œ ì•Œë¦¼</Text>
                            <Text>
                              {notificationSettings.voteReminder.enabled 
                                ? `í™œì„± - ${notificationSettings.voteReminder.beforeHours}ì‹œê°„ ì „ ì•Œë¦¼` 
                                : 'ë¹„í™œì„±'}
                            </Text>
                          </Box>
                          <Box>
                            <Text fontSize="sm" color="gray.600" fontWeight="bold">ì‹ ê·œ íšŒì› ì•Œë¦¼</Text>
                            <Text>
                              {notificationSettings.newMemberNotification.enabled ? 'í™œì„±' : 'ë¹„í™œì„±'}
                            </Text>
                          </Box>
                          <Box>
                            <Text fontSize="sm" color="gray.600" fontWeight="bold">ê²½ê¸° ê²°ê³¼ ì•Œë¦¼</Text>
                            <Text>
                              {notificationSettings.gameResultNotification.enabled ? 'í™œì„±' : 'ë¹„í™œì„±'}
                            </Text>
                          </Box>
                        </SimpleGrid>
                      </VStack>
                    </CardBody>
                  </Card>
                </VStack>
              )}

              {/* ì„ ìˆ˜ ê´€ë¦¬ */}
              {selectedMenu === 'players' && hasPermission('all') && (
                <VStack spacing={8} align="stretch" w="100%">
                  <Flex justify="space-between" align="center">
                    <Text fontSize="2xl" fontWeight="bold" color="#004ea8">âš½ ì„ ìˆ˜ ê´€ë¦¬</Text>
                    <Button
                      colorScheme="blue"
                      bg="#004ea8"
                      _hover={{ bg: '#003d7a' }}
                      onClick={() => setIsPlayerFormOpen(true)}
                      leftIcon={<AddIcon />}
                    >
                      ì„ ìˆ˜ ì¶”ê°€
                    </Button>
                  </Flex>

                  {/* ì„ ìˆ˜ í†µê³„ ìš”ì•½ */}
                  <SimpleGrid columns={{ base: 1, md: 3 }} spacing={6} w="100%">
                    <Card>
                      <CardBody>
                        <Stat>
                          <StatLabel color="gray.600">ì „ì²´ ì„ ìˆ˜</StatLabel>
                          <StatNumber color="#004ea8">{players.length}ëª…</StatNumber>
                          <StatHelpText color="green.500">
                            í™œì„± {players.filter(p => p.isActive).length}ëª…
                          </StatHelpText>
                        </Stat>
                      </CardBody>
                    </Card>
                    
                    <Card>
                      <CardBody>
                        <Stat>
                          <StatLabel color="gray.600">í‰ê·  ì¶œì„ë¥ </StatLabel>
                          <StatNumber color="#004ea8">
                            {players.length > 0 
                              ? Math.round(players.reduce((sum, p) => sum + p.attendanceRate, 0) / players.length)
                              : 0}%
                          </StatNumber>
                          <StatHelpText color="blue.500">
                            ì§€ë‚œ ë‹¬ ê¸°ì¤€
                          </StatHelpText>
                        </Stat>
                      </CardBody>
                    </Card>
                    
                    <Card>
                      <CardBody>
                        <Stat>
                          <StatLabel color="gray.600">í‰ê·  ì‹¤ë ¥</StatLabel>
                          <StatNumber color="#004ea8">
                            {players.length > 0 
                              ? Math.round(players.reduce((sum, p) => sum + p.skillRating, 0) / players.length)
                              : 0}ì 
                          </StatNumber>
                          <StatHelpText color="purple.500">
                            100ì  ë§Œì 
                          </StatHelpText>
                        </Stat>
                      </CardBody>
                    </Card>
                  </SimpleGrid>

                  {/* ì„ ìˆ˜ ëª©ë¡ */}
                  <Card w="100%">
                    <CardBody>
                      <VStack spacing={4} align="stretch">
                        <Text fontSize="lg" fontWeight="bold" color="#004ea8">ğŸ“‹ ì„ ìˆ˜ ëª©ë¡</Text>
                        <Divider />
                        
                        <TableContainer>
                          <Table variant="simple">
                            <Thead>
                              <Tr>
                                <Th>ì´ë¦„</Th>
                                <Th>í¬ì§€ì…˜</Th>
                                <Th>ë“±ë²ˆí˜¸</Th>
                                <Th>ì‹¤ë ¥</Th>
                                <Th>ì¶œì„ë¥ </Th>
                                <Th>ìƒíƒœ</Th>
                                <Th>ê´€ë¦¬</Th>
                              </Tr>
                            </Thead>
                            <Tbody>
                              {players.map((player) => (
                                <Tr key={player.id}>
                                  <Td fontWeight="bold">{player.name}</Td>
                                  <Td>
                                    <Badge colorScheme="blue" variant="subtle">
                                      {player.position}
                                    </Badge>
                                  </Td>
                                  <Td>{player.jerseyNumber || '-'}</Td>
                                  <Td>
                                    <Progress 
                                      value={player.skillRating} 
                                      colorScheme="green"
                                      size="sm"
                                      w="60px"
                                    />
                                    <Text fontSize="xs" mt={1}>{player.skillRating}/100</Text>
                                  </Td>
                                  <Td>
                                    <Progress 
                                      value={player.attendanceRate} 
                                      colorScheme="blue"
                                      size="sm"
                                      w="60px"
                                    />
                                    <Text fontSize="xs" mt={1}>{player.attendanceRate}%</Text>
                                  </Td>
                                  <Td>
                                    <Badge colorScheme={player.isActive ? 'green' : 'gray'}>
                                      {player.isActive ? 'í™œì„±' : 'ë¹„í™œì„±'}
                                    </Badge>
                                  </Td>
                                  <Td>
                                    <ButtonGroup size="sm" spacing={2}>
                                      <Button
                                        colorScheme="blue"
                                        variant="ghost"
                                        onClick={() => handleEditPlayer(player)}
                                        leftIcon={<EditIcon />}
                                      >
                                        ìˆ˜ì •
                                      </Button>
                                      <Button
                                        colorScheme="red"
                                        variant="ghost"
                                        onClick={() => handleDeletePlayer(player.id)}
                                        leftIcon={<DeleteIcon />}
                                      >
                                        ì‚­ì œ
                                      </Button>
                                    </ButtonGroup>
                                  </Td>
                                </Tr>
                              ))}
                            </Tbody>
                          </Table>
                        </TableContainer>
                        
                        {players.length === 0 && (
                          <Flex justify="center" py={8}>
                            <Text color="gray.500">ë“±ë¡ëœ ì„ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.</Text>
                          </Flex>
                        )}
                      </VStack>
                    </CardBody>
                  </Card>

                  {/* ì„ ìˆ˜ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ */}
                  <Modal isOpen={isPlayerFormOpen} onClose={() => {
                    setIsPlayerFormOpen(false);
                    setEditingPlayer(null);
                    setNewPlayer({
                      name: '',
                      position: 'MF',
                      preferredPosition: [],
                      skillRating: 70,
                      attendanceRate: 0,
                      isActive: true,
                      joinDate: new Date().toISOString().split('T')[0]
                    });
                  }}>
                    <ModalOverlay />
                    <ModalContent maxW="600px">
                      <ModalHeader>
                        {editingPlayer ? 'ì„ ìˆ˜ ì •ë³´ ìˆ˜ì •' : 'ìƒˆ ì„ ìˆ˜ ì¶”ê°€'}
                      </ModalHeader>
                      <ModalCloseButton />
                      <ModalBody pb={6}>
                        <VStack spacing={4} align="stretch">
                          <SimpleGrid columns={2} spacing={4}>
                            <FormControl isRequired>
                              <FormLabel>ì´ë¦„</FormLabel>
                              <Input
                                value={newPlayer.name || ''}
                                onChange={(e) => setNewPlayer({...newPlayer, name: e.target.value})}
                                placeholder="ì„ ìˆ˜ ì´ë¦„"
                                focusBorderColor="#004ea8"
                              />
                            </FormControl>
                            
                            <FormControl>
                              <FormLabel>ì£¼ í¬ì§€ì…˜</FormLabel>
                              <Select
                                value={newPlayer.position || 'MF'}
                                onChange={(e) => setNewPlayer({...newPlayer, position: e.target.value})}
                                focusBorderColor="#004ea8"
                              >
                                <option value="GK">ê³¨í‚¤í¼ (GK)</option>
                                <option value="DF">ìˆ˜ë¹„ìˆ˜ (DF)</option>
                                <option value="MF">ë¯¸ë“œí•„ë” (MF)</option>
                                <option value="FW">ê³µê²©ìˆ˜ (FW)</option>
                              </Select>
                            </FormControl>
                          </SimpleGrid>

                          <SimpleGrid columns={2} spacing={4}>
                            <FormControl>
                              <FormLabel>ë“±ë²ˆí˜¸</FormLabel>
                              <NumberInput
                                value={newPlayer.jerseyNumber || ''}
                                onChange={(_, value) => setNewPlayer({...newPlayer, jerseyNumber: value})}
                                min={1}
                                max={99}
                              >
                                <NumberInputField placeholder="ë“±ë²ˆí˜¸" />
                              </NumberInput>
                            </FormControl>
                            
                            <FormControl>
                              <FormLabel>ê°€ì…ì¼</FormLabel>
                              <Input
                                type="date"
                                value={newPlayer.joinDate || ''}
                                onChange={(e) => setNewPlayer({...newPlayer, joinDate: e.target.value})}
                                focusBorderColor="#004ea8"
                              />
                            </FormControl>
                          </SimpleGrid>

                          <SimpleGrid columns={2} spacing={4}>
                            <FormControl>
                              <FormLabel>ì „í™”ë²ˆí˜¸</FormLabel>
                              <Input
                                value={newPlayer.phone || ''}
                                onChange={(e) => setNewPlayer({...newPlayer, phone: e.target.value})}
                                placeholder="010-1234-5678"
                                focusBorderColor="#004ea8"
                              />
                            </FormControl>
                            
                            <FormControl>
                              <FormLabel>ì´ë©”ì¼</FormLabel>
                              <Input
                                type="email"
                                value={newPlayer.email || ''}
                                onChange={(e) => setNewPlayer({...newPlayer, email: e.target.value})}
                                placeholder="player@example.com"
                                focusBorderColor="#004ea8"
                              />
                            </FormControl>
                          </SimpleGrid>

                          <SimpleGrid columns={2} spacing={4}>
                            <FormControl>
                              <FormLabel>ì‹¤ë ¥ í‰ê°€ ({newPlayer.skillRating || 70}/100)</FormLabel>
                              <NumberInput
                                value={newPlayer.skillRating || 70}
                                onChange={(_, value) => setNewPlayer({...newPlayer, skillRating: value || 70})}
                                min={0}
                                max={100}
                              >
                                <NumberInputField />
                                <NumberInputStepper>
                                  <NumberIncrementStepper />
                                  <NumberDecrementStepper />
                                </NumberInputStepper>
                              </NumberInput>
                            </FormControl>
                            
                            <FormControl>
                              <FormLabel>ì¶œì„ë¥  ({newPlayer.attendanceRate || 0}%)</FormLabel>
                              <NumberInput
                                value={newPlayer.attendanceRate || 0}
                                onChange={(_, value) => setNewPlayer({...newPlayer, attendanceRate: value || 0})}
                                min={0}
                                max={100}
                              >
                                <NumberInputField />
                                <NumberInputStepper>
                                  <NumberIncrementStepper />
                                  <NumberDecrementStepper />
                                </NumberInputStepper>
                              </NumberInput>
                            </FormControl>
                          </SimpleGrid>

                          <FormControl>
                            <FormLabel>ë©”ëª¨</FormLabel>
                            <Textarea
                              value={newPlayer.notes || ''}
                              onChange={(e) => setNewPlayer({...newPlayer, notes: e.target.value})}
                              placeholder="ì„ ìˆ˜ì— ëŒ€í•œ ì¶”ê°€ ì •ë³´ë‚˜ ë©”ëª¨"
                              rows={3}
                              focusBorderColor="#004ea8"
                            />
                          </FormControl>

                          <FormControl display="flex" alignItems="center">
                            <FormLabel mb="0">í™œì„± ì„ ìˆ˜</FormLabel>
                            <Switch
                              isChecked={newPlayer.isActive !== false}
                              onChange={(e) => setNewPlayer({...newPlayer, isActive: e.target.checked})}
                              colorScheme="blue"
                            />
                          </FormControl>

                          <Flex justify="flex-end" gap={3} pt={4}>
                            <Button
                              onClick={() => {
                                setIsPlayerFormOpen(false);
                                setEditingPlayer(null);
                                setNewPlayer({
                                  name: '',
                                  position: 'MF',
                                  preferredPosition: [],
                                  skillRating: 70,
                                  attendanceRate: 0,
                                  isActive: true,
                                  joinDate: new Date().toISOString().split('T')[0]
                                });
                              }}
                            >
                              ì·¨ì†Œ
                            </Button>
                            <Button
                              colorScheme="blue"
                              bg="#004ea8"
                              _hover={{ bg: '#003d7a' }}
                              onClick={editingPlayer ? handleUpdatePlayer : handleAddPlayer}
                            >
                              {editingPlayer ? 'ìˆ˜ì •' : 'ì¶”ê°€'}
                            </Button>
                          </Flex>
                        </VStack>
                      </ModalBody>
                    </ModalContent>
                  </Modal>
                </VStack>
              )}

              {/* í™œë™ ë¶„ì„ */}
              {selectedMenu === 'analytics' && hasPermission('all') && (
                <VStack spacing={8} align="stretch" w="100%">
                  <Text fontSize="2xl" fontWeight="bold" color="#004ea8">ğŸ“ˆ í™œë™ ë¶„ì„</Text>

                  {/* ì›”ê°„ í™œë™ ìš”ì•½ */}
                  <SimpleGrid columns={{ base: 1, md: 2, lg: 4 }} spacing={6} w="100%">
                    <Card bg="gradient(to-r, teal.500, teal.600)" color="white" shadow="lg">
                      <CardBody p={6}>
                        <Stat>
                          <StatLabel color="teal.800" fontSize="md" fontWeight="medium">ì´ë²ˆ ë‹¬ ì°¸ê°€ìœ¨</StatLabel>
                          <StatNumber color="#495057" fontWeight="bold" fontSize="2xl">
                            {(() => {
                              const currentMonth = new Date().getMonth() + 1;
                              const currentYear = new Date().getFullYear();
                              const monthlyStats = calculateMonthlyStats(currentMonth, currentYear);
                              const totalMembers = userList.length;
                              return totalMembers > 0 ? Math.round((monthlyStats.uniqueActiveUsers / totalMembers) * 100) : 0;
                            })()}%
                          </StatNumber>
                          <StatHelpText color="teal.800" fontSize="sm" fontWeight="normal">
                            <StatArrow type="increase" />
                            ì‹¤ì œ ì°¸ì—¬ ë°ì´í„° ê¸°ì¤€
                          </StatHelpText>
                        </Stat>
                      </CardBody>
                    </Card>
                    
                    <Card bg="gradient(to-r, cyan.500, cyan.600)" color="white" shadow="lg">
                      <CardBody p={6}>
                        <Stat>
                          <StatLabel color="cyan.800" fontSize="md" fontWeight="medium">íˆ¬í‘œ ì°¸ì—¬ìœ¨</StatLabel>
                          <StatNumber color="#495057" fontWeight="bold" fontSize="2xl">
                            {(() => {
                              const activityData = collectActivityData();
                              const totalVotes = activityData.votes.length;
                              const totalGames = games.length;
                              return totalGames > 0 ? Math.round((totalVotes / totalGames) * 100) : 0;
                            })()}%
                          </StatNumber>
                          <StatHelpText color="cyan.800" fontSize="sm" fontWeight="normal">
                            <StatArrow type="increase" />
                            ì‹¤ì œ íˆ¬í‘œ ë°ì´í„° ê¸°ì¤€
                          </StatHelpText>
                        </Stat>
                      </CardBody>
                    </Card>
                    
                    <Card bg="gradient(to-r, pink.500, pink.600)" color="white" shadow="lg">
                      <CardBody p={6}>
                        <Stat>
                          <StatLabel color="pink.800" fontSize="md" fontWeight="medium">í™œì„± ì‚¬ìš©ì</StatLabel>
                          <StatNumber color="#495057" fontWeight="bold" fontSize="2xl">
                            {(() => {
                              const currentMonth = new Date().getMonth() + 1;
                              const currentYear = new Date().getFullYear();
                              const monthlyStats = calculateMonthlyStats(currentMonth, currentYear);
                              return monthlyStats.uniqueActiveUsers;
                            })()}
                          </StatNumber>
                          <StatHelpText color="pink.800" fontSize="sm" fontWeight="normal">
                            <StatArrow type="increase" />
                            ì´ë²ˆ ë‹¬ í™œë™ ê¸°ì¤€
                          </StatHelpText>
                        </Stat>
                      </CardBody>
                    </Card>
                    
                    <Card bg="gradient(to-r, yellow.500, yellow.600)" color="white" shadow="lg">
                      <CardBody p={6}>
                        <Stat>
                          <StatLabel color="yellow.800" fontSize="md" fontWeight="medium">ì´ë²ˆ ë‹¬ ê²½ê¸°ìˆ˜</StatLabel>
                          <StatNumber color="#495057" fontWeight="bold" fontSize="2xl">
                            {(() => {
                              const currentMonth = new Date().getMonth() + 1;
                              const currentYear = new Date().getFullYear();
                              const monthlyStats = calculateMonthlyStats(currentMonth, currentYear);
                              return monthlyStats.totalGames;
                            })()}
                          </StatNumber>
                          <StatHelpText color="yellow.800" fontSize="sm" fontWeight="normal">
                            <StatArrow type="increase" />
                            ì‹¤ì œ ê²½ê¸° ë°ì´í„° ê¸°ì¤€
                          </StatHelpText>
                        </Stat>
                      </CardBody>
                    </Card>
                  </SimpleGrid>

                  <SimpleGrid columns={{ base: 1, lg: 2 }} spacing={8} w="100%">
                    {/* íšŒì›ë³„ ì°¸ì—¬ í˜„í™© */}
                    <Card>
                      <CardBody>
                        <VStack spacing={4} align="stretch">
                          <Text fontSize="lg" fontWeight="bold" color="#004ea8">ğŸ‘¥ íšŒì›ë³„ ì°¸ì—¬ í˜„í™©</Text>
                          <Divider />
                          
                          <TableContainer maxH="400px" overflowY="auto">
                            <Table size="sm" variant="simple">
                              <Thead position="sticky" top={0} bg="white" zIndex={1}>
                                <Tr>
                                  <Th>íšŒì›ëª…</Th>
                                  <Th>ê²½ê¸° ì°¸ì—¬</Th>
                                  <Th>íˆ¬í‘œ ì°¸ì—¬</Th>
                                  <Th>í™œë™ì ìˆ˜</Th>
                                </Tr>
                              </Thead>
                              <Tbody>
                                {userList.map((member) => {
                                  const participation = calculateParticipationRate(member.id);
                                  const activityScore = Math.round(participation.overallActivityRate);
                                  
                                  return (
                                    <Tr key={member.id}>
                                      <Td fontWeight="bold">
                                        {member.name}
                                        <Badge 
                                          ml={2} 
                                          size="sm"
                                          colorScheme={
                                            member.role === 'SUPER_ADMIN' ? 'red' :
                                            member.role === 'ADMIN' ? 'blue' : 'gray'
                                          }
                                        >
                                          {member.role === 'SUPER_ADMIN' ? 'ìŠˆí¼ê´€ë¦¬ì' :
                                           member.role === 'ADMIN' ? 'ê´€ë¦¬ì' : 'íšŒì›'}
                                        </Badge>
                                      </Td>
                                      <Td>
                                        <Progress 
                                          value={participation.gameParticipationRate} 
                                          colorScheme="green"
                                          size="sm"
                                          w="60px"
                                        />
                                        <Text fontSize="xs" mt={1}>{Math.round(participation.gameParticipationRate)}%</Text>
                                      </Td>
                                      <Td>
                                        <Progress 
                                          value={participation.voteRate} 
                                          colorScheme="blue"
                                          size="sm"
                                          w="60px"
                                        />
                                        <Text fontSize="xs" mt={1}>{Math.round(participation.voteRate)}%</Text>
                                      </Td>
                                      <Td>
                                        <Badge 
                                          colorScheme={
                                            activityScore >= 80 ? 'green' :
                                            activityScore >= 60 ? 'yellow' : 'red'
                                          }
                                        >
                                          {activityScore}ì 
                                        </Badge>
                                      </Td>
                                    </Tr>
                                  );
                                })}
                              </Tbody>
                            </Table>
                          </TableContainer>
                          
                          {userList.length === 0 && (
                            <Flex justify="center" py={8}>
                              <Text color="gray.500">íšŒì› ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</Text>
                            </Flex>
                          )}
                        </VStack>
                      </CardBody>
                    </Card>

                    {/* ì›”ë³„ ê²½ê¸° í˜„í™© */}
                    <Card>
                      <CardBody>
                        <VStack spacing={4} align="stretch">
                          <Text fontSize="lg" fontWeight="bold" color="#004ea8">ğŸ“… ì›”ë³„ ê²½ê¸° í˜„í™©</Text>
                          <Divider />
                          
                          <VStack spacing={3} align="stretch">
                            {Array.from({ length: 6 }).map((_, index) => {
                              const monthsAgo = 5 - index;
                              const date = new Date();
                              date.setMonth(date.getMonth() - monthsAgo);
                              const monthName = date.toLocaleDateString('ko-KR', { month: 'long' });
                              
                              const monthlyGames = games.filter(g => {
                                const gameDate = new Date(g.date);
                                return gameDate.getMonth() === date.getMonth() && 
                                       gameDate.getFullYear() === date.getFullYear();
                              });
                              
                              const gameCount = monthlyGames.length;
                              const maxGames = 8; // ì›” ìµœëŒ€ ê²½ê¸°ìˆ˜ ê°€ì •
                              
                              return (
                                <Box key={index}>
                                  <Flex justify="space-between" align="center" mb={1}>
                                    <Text fontSize="sm" fontWeight="bold">
                                      {monthName}
                                    </Text>
                                    <Text fontSize="sm" color="gray.600">
                                      {gameCount}ê²½ê¸°
                                    </Text>
                                  </Flex>
                                  <Progress 
                                    value={gameCount > 0 ? (gameCount / maxGames) * 100 : 0}
                                    colorScheme="blue"
                                    size="sm"
                                    bg="gray.100"
                                  />
                                </Box>
                              );
                            })}
                          </VStack>
                          
                          <Divider />
                          <Box>
                            <Text fontSize="sm" color="gray.600" mb={2}>ê²½ê¸° ìœ í˜•ë³„ ë¶„í¬</Text>
                            <VStack spacing={2} align="stretch">
                              <Flex justify="space-between">
                                <Text fontSize="sm">ë§¤ì¹˜ ê²½ê¸°</Text>
                                <Badge colorScheme="red" variant="subtle">
                                  {games.filter(g => g.opponent).length}íšŒ
                                </Badge>
                              </Flex>
                              <Flex justify="space-between">
                                <Text fontSize="sm">ìì²´ ê²½ê¸°</Text>
                                <Badge colorScheme="blue" variant="subtle">
                                  {games.filter(g => !g.opponent).length}íšŒ
                                </Badge>
                              </Flex>
                            </VStack>
                          </Box>
                        </VStack>
                      </CardBody>
                    </Card>
                  </SimpleGrid>

                  {/* ìƒì„¸ ë¶„ì„ ë¦¬í¬íŠ¸ */}
                  <Card w="100%">
                    <CardBody>
                      <VStack spacing={6} align="stretch">
                        <Text fontSize="lg" fontWeight="bold" color="#004ea8">ğŸ“Š ìƒì„¸ ë¶„ì„ ë¦¬í¬íŠ¸</Text>
                        <Divider />
                        
                        <SimpleGrid columns={{ base: 1, md: 3 }} spacing={6}>
                          <Box>
                            <Text fontSize="md" fontWeight="bold" mb={3}>ğŸ‘‘ ìµœê³  ì°¸ì—¬ì</Text>
                            <VStack spacing={2} align="stretch">
                              {userList.slice(0, 3).map((member, index) => (
                                <Flex key={member.id} justify="space-between" align="center">
                                  <HStack>
                                    <Badge colorScheme="yellow" variant="solid" fontSize="xs">
                                      {index + 1}ìœ„
                                    </Badge>
                                    <Text fontSize="sm" fontWeight="bold">{member.name}</Text>
                                  </HStack>
                                  <Text fontSize="sm" color="gray.600">
                                    {Math.floor(Math.random() * 20) + 80}ì 
                                  </Text>
                                </Flex>
                              ))}
                            </VStack>
                          </Box>
                          
                          <Box>
                            <Text fontSize="md" fontWeight="bold" mb={3}>âš½ ì´ë²ˆ ë‹¬ í•˜ì´ë¼ì´íŠ¸</Text>
                            <VStack spacing={2} align="stretch">
                              <Text fontSize="sm">â€¢ ì´ {games.filter(g => {
                                const gameDate = new Date(g.date);
                                const now = new Date();
                                return gameDate.getMonth() === now.getMonth();
                              }).length}ê²½ê¸° ì§„í–‰</Text>
                              <Text fontSize="sm">â€¢ í‰ê·  ì°¸ê°€ì¸ì›: {Math.floor(Math.random() * 5) + 15}ëª…</Text>
                              <Text fontSize="sm">â€¢ ì‹ ê·œ ê°€ì…ì: {userList.filter(u => {
                                if (!u.createdAt) return false;
                                const created = new Date(u.createdAt);
                                const now = new Date();
                                return created.getMonth() === now.getMonth();
                              }).length}ëª…</Text>
                              <Text fontSize="sm">â€¢ íŒ€ í™œë™ì„±: 
                                <Badge colorScheme="green" ml={2}>ë§¤ìš° ë†’ìŒ</Badge>
                              </Text>
                            </VStack>
                          </Box>
                          
                          <Box>
                            <Text fontSize="md" fontWeight="bold" mb={3}>ğŸ† ìƒìœ„ ì°¸ì—¬ì</Text>
                            <VStack spacing={2} align="stretch">
                              {getTopParticipants().slice(0, 3).map((participant, index) => (
                                <Flex key={participant.userId} justify="space-between" align="center">
                                  <HStack>
                                    <Badge 
                                      colorScheme={
                                        index === 0 ? 'yellow' : 
                                        index === 1 ? 'gray' : 'orange'
                                      }
                                      size="sm"
                                    >
                                      {index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : 'ğŸ¥‰'}
                                    </Badge>
                                    <Text fontSize="sm" fontWeight="bold">{participant.name}</Text>
                                  </HStack>
                                  <Text fontSize="sm" color="gray.600">
                                    {Math.round(participant.overallActivityRate)}%
                                  </Text>
                                </Flex>
                              ))}
                            </VStack>
                          </Box>
                          
                          <Box>
                            <Text fontSize="md" fontWeight="bold" mb={3}>ğŸ“ˆ ê°œì„  í¬ì¸íŠ¸</Text>
                            <VStack spacing={2} align="stretch">
                              <Text fontSize="sm">â€¢ íˆ¬í‘œ ì°¸ì—¬ìœ¨ í–¥ìƒ í•„ìš”</Text>
                              <Text fontSize="sm">â€¢ ì‹ ê·œ íšŒì› ì˜¨ë³´ë”© ê°•í™”</Text>
                              <Text fontSize="sm">â€¢ ê²½ê¸° í›„ í”¼ë“œë°± ìˆ˜ì§‘</Text>
                              <Text fontSize="sm">â€¢ íŒ€ ë‚´ ì†Œí†µ í™œì„±í™”</Text>
                            </VStack>
                          </Box>
                        </SimpleGrid>
                      </VStack>
                    </CardBody>
                  </Card>
                </VStack>
              )}

              {/* ê³µì§€ì‚¬í•­ ê´€ë¦¬ */}
              {selectedMenu === 'announcements' && hasPermission('all') && (
                <VStack spacing={8} align="stretch" w="100%">
                  <Flex justify="space-between" align="center">
                    <Text fontSize="2xl" fontWeight="bold" color="#004ea8">ğŸ“¢ ê³µì§€ì‚¬í•­ ê´€ë¦¬</Text>
                    <Button
                      colorScheme="blue"
                      bg="#004ea8"
                      _hover={{ bg: '#003d7a' }}
                      onClick={() => setIsAnnouncementFormOpen(true)}
                      leftIcon={<AddIcon />}
                    >
                      ê³µì§€ ì‘ì„±
                    </Button>
                  </Flex>

                  {/* ê³µì§€ì‚¬í•­ í†µê³„ */}
                  <SimpleGrid columns={{ base: 1, md: 3 }} spacing={6} w="100%">
                    <Card>
                      <CardBody>
                        <Stat>
                          <StatLabel color="gray.600">ì „ì²´ ê³µì§€</StatLabel>
                          <StatNumber color="#004ea8">{announcements.length}ê°œ</StatNumber>
                          <StatHelpText color="green.500">
                            í™œì„± {announcements.filter(a => a.isActive).length}ê°œ
                          </StatHelpText>
                        </Stat>
                      </CardBody>
                    </Card>
                    
                    <Card>
                      <CardBody>
                        <Stat>
                          <StatLabel color="gray.600">ì¤‘ìš” ê³µì§€</StatLabel>
                          <StatNumber color="#004ea8">
                            {announcements.filter(a => a.type === 'urgent').length}ê°œ
                          </StatNumber>
                          <StatHelpText color="red.500">
                            ê¸´ê¸‰ ì•Œë¦¼
                          </StatHelpText>
                        </Stat>
                      </CardBody>
                    </Card>
                    
                    <Card>
                      <CardBody>
                        <Stat>
                          <StatLabel color="gray.600">ê³ ì • ê³µì§€</StatLabel>
                          <StatNumber color="#004ea8">
                            {announcements.filter(a => a.pinned).length}ê°œ
                          </StatNumber>
                          <StatHelpText color="purple.500">
                            ìƒë‹¨ ê³ ì •
                          </StatHelpText>
                        </Stat>
                      </CardBody>
                    </Card>
                  </SimpleGrid>

                  {/* ê³µì§€ì‚¬í•­ ëª©ë¡ */}
                  <Card w="100%">
                    <CardBody>
                      <VStack spacing={4} align="stretch">
                        <Text fontSize="lg" fontWeight="bold" color="#004ea8">ğŸ“‹ ê³µì§€ì‚¬í•­ ëª©ë¡</Text>
                        <Divider />
                        
                        <VStack spacing={3} align="stretch">
                          {announcements
                            .sort((a, b) => {
                              if (a.pinned && !b.pinned) return -1;
                              if (!a.pinned && b.pinned) return 1;
                              return new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime();
                            })
                            .map((announcement) => (
                            <Card key={announcement.id} variant="outline">
                              <CardBody>
                                <VStack spacing={3} align="stretch">
                                  <Flex justify="space-between" align="flex-start">
                                    <VStack spacing={2} align="flex-start" flex={1}>
                                      <HStack spacing={2} wrap="wrap">
                                        <Text fontSize="lg" fontWeight="bold" color="#004ea8">
                                          {announcement.title}
                                        </Text>
                                        <Badge 
                                          colorScheme={
                                            announcement.type === 'urgent' ? 'red' :
                                            announcement.type === 'info' ? 'blue' : 'gray'
                                          }
                                          variant="solid"
                                        >
                                          {announcement.type === 'urgent' ? 'ê¸´ê¸‰' :
                                           announcement.type === 'info' ? 'ì •ë³´' : 'ì¼ë°˜'}
                                        </Badge>
                                        {announcement.pinned && (
                                          <Badge colorScheme="purple" variant="solid">ğŸ“Œ ê³ ì •</Badge>
                                        )}
                                        <Badge 
                                          colorScheme={announcement.isActive ? 'green' : 'gray'}
                                          variant="outline"
                                        >
                                          {announcement.isActive ? 'í™œì„±' : 'ë¹„í™œì„±'}
                                        </Badge>
                                      </HStack>
                                      
                                      <Text fontSize="sm" color="gray.700" noOfLines={2}>
                                        {announcement.content}
                                      </Text>
                                      
                                      <HStack spacing={4} fontSize="xs" color="gray.500">
                                        <Text>ì‘ì„±ì: {announcement.author}</Text>
                                        <Text>ì‘ì„±ì¼: {new Date(announcement.createdAt).toLocaleDateString('ko-KR')}</Text>
                                        <Text>
                                          ë…¸ì¶œê¸°ê°„: {new Date(announcement.startDate).toLocaleDateString('ko-KR')} ~ 
                                          {new Date(announcement.endDate).toLocaleDateString('ko-KR')}
                                        </Text>
                                      </HStack>
                                    </VStack>
                                    
                                    <ButtonGroup size="sm" spacing={2}>
                                      <Button
                                        colorScheme={announcement.isActive ? 'orange' : 'green'}
                                        variant="ghost"
                                        onClick={() => handleToggleAnnouncementStatus(announcement.id)}
                                      >
                                        {announcement.isActive ? 'ë¹„í™œì„±í™”' : 'í™œì„±í™”'}
                                      </Button>
                                      <Button
                                        colorScheme="blue"
                                        variant="ghost"
                                        onClick={() => handleEditAnnouncement(announcement)}
                                        leftIcon={<EditIcon />}
                                      >
                                        ìˆ˜ì •
                                      </Button>
                                      <Button
                                        colorScheme="red"
                                        variant="ghost"
                                        onClick={() => handleDeleteAnnouncement(announcement.id)}
                                        leftIcon={<DeleteIcon />}
                                      >
                                        ì‚­ì œ
                                      </Button>
                                    </ButtonGroup>
                                  </Flex>
                                </VStack>
                              </CardBody>
                            </Card>
                          ))}
                        </VStack>
                        
                        {announcements.length === 0 && (
                          <Flex justify="center" py={8}>
                            <Text color="gray.500">ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</Text>
                          </Flex>
                        )}
                      </VStack>
                    </CardBody>
                  </Card>

                  {/* ê³µì§€ì‚¬í•­ ì‘ì„±/ìˆ˜ì • ëª¨ë‹¬ */}
                  <Modal isOpen={isAnnouncementFormOpen} onClose={() => {
                    setIsAnnouncementFormOpen(false);
                    setEditingAnnouncement(null);
                    setNewAnnouncement({
                      title: '',
                      content: '',
                      type: 'normal',
                      startDate: new Date().toISOString().split('T')[0],
                      endDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                      isActive: true,
                      pinned: false
                    });
                  }} size="xl">
                    <ModalOverlay />
                    <ModalContent maxW="800px">
                      <ModalHeader>
                        {editingAnnouncement ? 'ê³µì§€ì‚¬í•­ ìˆ˜ì •' : 'ìƒˆ ê³µì§€ì‚¬í•­ ì‘ì„±'}
                      </ModalHeader>
                      <ModalCloseButton />
                      <ModalBody pb={6}>
                        <VStack spacing={6} align="stretch">
                          <FormControl isRequired>
                            <FormLabel>ì œëª©</FormLabel>
                            <Input
                              value={newAnnouncement.title || ''}
                              onChange={(e) => setNewAnnouncement({...newAnnouncement, title: e.target.value})}
                              placeholder="ê³µì§€ì‚¬í•­ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                              focusBorderColor="#004ea8"
                            />
                          </FormControl>
                          
                          <FormControl isRequired>
                            <FormLabel>ë‚´ìš©</FormLabel>
                            <Textarea
                              value={newAnnouncement.content || ''}
                              onChange={(e) => setNewAnnouncement({...newAnnouncement, content: e.target.value})}
                              placeholder="ê³µì§€ì‚¬í•­ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"
                              rows={8}
                              focusBorderColor="#004ea8"
                            />
                          </FormControl>

                          <SimpleGrid columns={3} spacing={4}>
                            <FormControl>
                              <FormLabel>ê³µì§€ ìœ í˜•</FormLabel>
                              <Select
                                value={newAnnouncement.type || 'normal'}
                                onChange={(e) => setNewAnnouncement({...newAnnouncement, type: e.target.value as 'urgent' | 'normal' | 'info'})}
                                focusBorderColor="#004ea8"
                              >
                                <option value="normal">ì¼ë°˜ ê³µì§€</option>
                                <option value="urgent">ê¸´ê¸‰ ê³µì§€</option>
                                <option value="info">ì •ë³´ ê³µì§€</option>
                              </Select>
                            </FormControl>
                            
                            <FormControl>
                              <FormLabel>ì‹œì‘ì¼</FormLabel>
                              <Input
                                type="date"
                                value={newAnnouncement.startDate || ''}
                                onChange={(e) => setNewAnnouncement({...newAnnouncement, startDate: e.target.value})}
                                focusBorderColor="#004ea8"
                              />
                            </FormControl>
                            
                            <FormControl>
                              <FormLabel>ì¢…ë£Œì¼</FormLabel>
                              <Input
                                type="date"
                                value={newAnnouncement.endDate || ''}
                                onChange={(e) => setNewAnnouncement({...newAnnouncement, endDate: e.target.value})}
                                focusBorderColor="#004ea8"
                              />
                            </FormControl>
                          </SimpleGrid>

                          <SimpleGrid columns={2} spacing={4}>
                            <FormControl display="flex" alignItems="center">
                              <FormLabel mb="0">ê³µì§€ í™œì„±í™”</FormLabel>
                              <Switch
                                isChecked={newAnnouncement.isActive !== false}
                                onChange={(e) => setNewAnnouncement({...newAnnouncement, isActive: e.target.checked})}
                                colorScheme="blue"
                              />
                            </FormControl>
                            
                            <FormControl display="flex" alignItems="center">
                              <FormLabel mb="0">ìƒë‹¨ ê³ ì •</FormLabel>
                              <Switch
                                isChecked={newAnnouncement.pinned || false}
                                onChange={(e) => setNewAnnouncement({...newAnnouncement, pinned: e.target.checked})}
                                colorScheme="purple"
                              />
                            </FormControl>
                          </SimpleGrid>

                          <Flex justify="flex-end" gap={3} pt={4}>
                            <Button
                              onClick={() => {
                                setIsAnnouncementFormOpen(false);
                                setEditingAnnouncement(null);
                                setNewAnnouncement({
                                  title: '',
                                  content: '',
                                  type: 'normal',
                                  startDate: new Date().toISOString().split('T')[0],
                                  endDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                                  isActive: true,
                                  pinned: false
                                });
                              }}
                            >
                              ì·¨ì†Œ
                            </Button>
                            <Button
                              colorScheme="blue"
                              bg="#004ea8"
                              _hover={{ bg: '#003d7a' }}
                              onClick={editingAnnouncement ? handleUpdateAnnouncement : handleAddAnnouncement}
                            >
                              {editingAnnouncement ? 'ìˆ˜ì •' : 'ë“±ë¡'}
                            </Button>
                          </Flex>
                        </VStack>
                      </ModalBody>
                    </ModalContent>
                  </Modal>
                </VStack>
              )}
            </>
          )}
        </Box>
      </Flex>
    </Box>
  );
}
