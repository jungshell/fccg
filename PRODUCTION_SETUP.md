# 🚀 프로덕션 환경 설정 완전 가이드

## 📋 준비된 값들

### 비밀번호 해시 (password123)
```
$2b$10$/TNmVeS8a5Hb/eYdBISSo.uONXVDh6r6rjCV0RPejaRoV.0MvxvHm
```

이 해시를 사용하여 프로덕션 DB에서 비밀번호를 설정합니다.

---

## 1️⃣ Render (백엔드) 환경 변수 설정

### Render 대시보드 접속
1. https://dashboard.render.com 접속
2. 프로젝트 선택 → Environment 탭

### 추가할 환경 변수들

```bash
DATABASE_URL=postgresql://your-neon-connection-string
JWT_SECRET=fc-chalggyeo-secret-production-key
FRONTEND_URL=https://fccg-inoi.vercel.app
BACKEND_URL=https://your-backend-url.onrender.com
PORT=4000
NODE_ENV=production
GMAIL_USER=sti60val@gmail.com
GMAIL_APP_PASSWORD=your-gmail-app-password
```

**⚠️ 중요**: 
- `DATABASE_URL`은 Neon에서 제공하는 연결 문자열 전체를 복사
- `JWT_SECRET`은 로컬과 동일하게 사용 (또는 새로 생성)

---

## 2️⃣ Vercel (프론트엔드) 환경 변수 설정

### Vercel 대시보드 접속
1. https://vercel.com 접속
2. 프로젝트 선택 → Settings → Environment Variables

### 추가할 환경 변수

```bash
VITE_API_BASE_URL=https://your-backend-url.onrender.com/api/auth
```

**⚠️ 중요**:
- Render 백엔드가 배포된 후 실제 URL로 변경
- 모든 환경 (Production, Preview, Development)에 추가

---

## 3️⃣ Neon (데이터베이스) 초기화

### Neon SQL Editor 접속
1. https://console.neon.tech 접속
2. 프로젝트 선택 → SQL Editor

### Step 1: 스키마 확인
Prisma 마이그레이션이 이미 적용되어 있다면 스킵 가능

### Step 2: 초기 데이터 삽입
아래 SQL을 실행:

```sql
-- 사용자 데이터 (비밀번호: password123)
INSERT INTO "User" (id, email, password, name, role, status, "createdAt", "updatedAt") 
VALUES (1, 'sti60val@gmail.com', '$2b$10$/TNmVeS8a5Hb/eYdBISSo.uONXVDh6r6rjCV0RPejaRoV.0MvxvHm', '정성인', 'SUPER_ADMIN', 'ACTIVE', now(), now())
ON CONFLICT (email) DO UPDATE SET 
  password = '$2b$10$/TNmVeS8a5Hb/eYdBISSo.uONXVDh6r6rjCV0RPejaRoV.0MvxvHm',
  role = 'SUPER_ADMIN',
  status = 'ACTIVE';

-- 현재 주 투표 세션 (11월 3일-7일)
INSERT INTO "VoteSession" (id, "weekStartDate", "startTime", "endTime", "isActive", "isCompleted", "createdAt", "updatedAt")
VALUES (1, '2025-11-03 00:00:00', '2025-11-02 00:00:00', '2025-11-06 23:59:59', true, false, now(), now())
ON CONFLICT (id) DO NOTHING;

-- 지난 주 투표 세션 (10월 27일-31일) - 완료됨
INSERT INTO "VoteSession" (id, "weekStartDate", "startTime", "endTime", "isActive", "isCompleted", "createdAt", "updatedAt")
VALUES (2, '2025-10-27 00:00:00', '2025-10-26 00:00:00', '2025-10-30 23:59:59', false, true, now(), now())
ON CONFLICT (id) DO NOTHING;

-- 지난 주 투표 데이터 (목, 금)
INSERT INTO "Vote" (id, "userId", "voteSessionId", "selectedDays", "createdAt", "updatedAt")
VALUES (1, 1, 2, '["THU","FRI"]', now(), now())
ON CONFLICT (id) DO NOTHING;

-- 현재 주 투표 데이터 (수, 금)
INSERT INTO "Vote" (id, "userId", "voteSessionId", "selectedDays", "createdAt", "updatedAt")
VALUES (2, 1, 1, '["WED","FRI"]', now(), now())
ON CONFLICT (id) DO NOTHING;

-- 지난 주 경기 데이터 (10월 30일) - 정규화된 값 사용
INSERT INTO "Game" (id, date, time, location, "gameType", "eventType", "memberNames", "selectedMembers", "mercenaryCount", "autoGenerated", confirmed, "createdById", "createdAt", "updatedAt")
VALUES (1, '2025-10-30 12:00:00', '19:00', '풋살장', 'MATCH', '매치', '["정성인"]', '["정성인"]', 0, false, true, 1, now(), now())
ON CONFLICT (id) DO UPDATE SET "eventType" = '매치', "gameType" = 'MATCH';
```

---

## 4️⃣ 배포 확인 및 테스트

### 1. Render 백엔드 배포 확인
- Render 대시보드에서 서비스 상태 확인
- 로그 확인: "서버가 4000번 포트에서 실행 중"
- Health check: `https://your-backend.onrender.com/api/auth/health`

### 2. Vercel 프론트엔드 배포 확인
- Vercel 대시보드에서 배포 상태 확인
- 프론트엔드 URL 접속

### 3. 로그인 테스트
- 이메일: `sti60val@gmail.com`
- 비밀번호: `password123`

---

## ✅ 체크리스트

배포 완료 후 확인:

- [ ] Render 백엔드가 정상 실행 중
- [ ] Vercel 프론트엔드가 정상 배포됨
- [ ] 로그인이 정상 작동
- [ ] 회원 목록이 표시됨
- [ ] 경기 목록이 표시됨
- [ ] 투표 데이터가 표시됨

---

## 🆘 문제 해결

### 로그인이 안 될 때
1. Neon SQL Editor에서 비밀번호 해시 재설정:
```sql
UPDATE "User" 
SET password = '$2b$10$/TNmVeS8a5Hb/eYdBISSo.uONXVDh6r6rjCV0RPejaRoV.0MvxvHm'
WHERE email = 'sti60val@gmail.com';
```

2. Render 로그에서 JWT_SECRET 확인
3. Vercel 환경 변수에서 VITE_API_BASE_URL 확인

### 데이터가 안 나올 때
1. Neon에서 데이터 존재 확인
2. Render 로그에서 DB 연결 오류 확인
3. DATABASE_URL이 올바른지 확인

---

## 📞 참고

- 모든 환경 변수는 **대소문자 구분**합니다
- 환경 변수 변경 후 **반드시 재배포**가 필요합니다
- Vercel은 자동 재배포, Render는 수동 재시작 필요할 수 있습니다

